(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[64],{Kq3J:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=s(a("bx4M"));a("g9YV");var l=s(a("wCAj"));a("P2fV");var n=s(a("NJEC"));a("Q9mQ");var o=s(a("diRs"));a("+L6B");var p=s(a("2/Rp"));a("5Dmo");var d=s(a("3S7+"));a("/xke");var c,u,h,m=s(a("TeRw")),f=a("MuoO"),g=a("7DNP"),b=s(a("wd/R")),v=r(a("q1tI")),S=a("LLXN"),P=s(a("puxM")),_=s(a("nvum")),M=s(a("XZXw")),E=a("vSx2"),y=s(a("QDog")),x=s(a("hMqj")),k=s(a("2lxJ")),R=s(a("8+Sn")),L=s(a("TNXg")),N=(c=(0,f.connect)(e=>{var t=e.list,a=e.loading,s=e.teamControl,r=e.enterprise;return{list:t,loading:a.models.list,currentTeam:s.currentTeam,currentRegionName:s.currentRegionName,currentEnterprise:r.currentEnterprise,currentTeamPermissionsInfo:s.currentTeamPermissionsInfo}}),c((h=class extends v.PureComponent{constructor(e){super(e),this.onPublishStore=(()=>{this.setState({selectStoreShow:!0})}),this.onPublishLocal=(()=>{this.handleShare("",{})}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchPublishRecoder()})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,s=t.regionName,r=t.appID;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:s,group_id:r},callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1})},handleError:e=>{e&&404===e.code&&this.props.dispatch(g.routerRedux.push("/team/".concat(y.default.getCurrTeamName(),"/region/").concat(y.default.getCurrRegionName(),"/apps")))}})}),this.fetchPublishRecoder=(()=>{this.setState({loading:!0});var e=this.props.match.params,t=e.teamName,a=e.appID,s=this.props.dispatch,r=this.state,i=r.page,l=r.pageSize;s({type:"application/fetchShareRecords",payload:{team_name:t,app_id:a,page:i,page_size:l},callback:e=>{e&&this.setState({recoders:e.list,total:e.bean.total,loading:!1})}})}),this.handleShare=((e,t)=>{var a=this.props.match.params,s=a.teamName,r=a.appID,i=this.props.dispatch;i({type:"application/ShareGroup",payload:{team_name:s,group_id:r,scope:e,target:t},callback:e=>{this.continuePublish(e.bean.ID,e.bean.step)}})}),this.hideSelectStoreShow=(()=>{this.setState({selectStoreShow:!1})}),this.handleStoreLoading=(e=>{this.setState({storeLoading:e})}),this.handleSelectStore=(e=>{this.handleStoreLoading(!0);var t=e.store_id;this.handleShare("goodrain",{store_id:t})}),this.deleteRecord=(e=>{var t=this.props.match.params,a=t.teamName,s=t.appID,r=this.props.dispatch;r({type:"application/deleteShareRecord",payload:{team_name:a,app_id:s,record_id:e},callback:()=>{this.fetchPublishRecoder()}})}),this.cancelPublish=(e=>{if(void 0!==e&&""!==e){var t=this.props.match.params.teamName,a=this.props.dispatch;a({type:"application/giveupShare",payload:{team_name:t,share_id:e},callback:()=>{this.fetchPublishRecoder()}})}else m.default.warning({message:(0,S.formatMessage)({id:"notification.warn.parameter_error"})})}),this.continuePublish=((e,t)=>{var a=this.props.dispatch,s=this.props.match.params,r=s.teamName,i=s.regionName,l=s.appID;1===t&&a(g.routerRedux.push("/team/".concat(r,"/region/").concat(i,"/apps/").concat(l,"/share/").concat(e,"/one"))),2===t&&a(g.routerRedux.push("/team/".concat(r,"/region/").concat(i,"/apps/").concat(l,"/share/").concat(e,"/two"))),this.handleStoreLoading(!1)}),this.handleBox=(e=>{return v.default.createElement("div",{className:L.default.version},v.default.createElement(d.default,{placement:"topLeft",title:e},e))}),this.state={loading:!0,appDetail:{},page:1,pageSize:10,total:0,storeLoading:!1,selectStoreShow:!1,language:"zh-CN"===R.default.get("language")}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,s=x.default.queryAppInfo(t,"share");s||y.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.fetchPublishRecoder()}render(){var e=[],t=this.state,a=t.appDetail,s=t.loading,r=t.loadingDetail,d=t.page,c=t.pageSize,u=t.total,h=t.selectStoreShow,m=t.recoders,f=t.storeLoading,y=t.language,x=this.props,R=x.currentEnterprise,N=x.currentTeam,w=x.currentRegionName,D=x.dispatch;return e=(0,E.createApp)((0,E.createTeam)((0,E.createEnterprise)(e,R),N,w),N,w,{appName:a.group_name,appID:a.group_id}),v.default.createElement(M.default,{breadcrumbList:e,loading:r,title:(0,S.formatMessage)({id:"appPublish.title"}),content:(0,S.formatMessage)({id:"appPublish.desc"}),titleSvg:k.default.getSvg("publishSvg",18)},v.default.createElement(i.default,{loading:s,extra:v.default.createElement("div",{style:y?{}:{display:"flex"}},v.default.createElement(p.default,{style:y?{marginRight:8}:{marginRight:8,padding:5},type:"primary",onClick:this.onPublishLocal},(0,S.formatMessage)({id:"appPublish.btn.local"})),v.default.createElement(p.default,{onClick:this.onPublishStore,style:y?{marginRight:8}:{marginRight:8,padding:5}},(0,S.formatMessage)({id:"appPublish.btn.market"}))),style:{borderRadius:5,boxShadow:"rgb(36 46 66 / 16%) 2px 4px 10px 0px"}},v.default.createElement(P.default,{sm:800},v.default.createElement(l.default,{pagination:u>10&&{current:d,pageSize:c,total:u,onChange:this.onPageChange},dataSource:m||[],columns:[{title:(0,S.formatMessage)({id:"appPublish.table.publishName"}),dataIndex:"app_model_name",render:(e,t)=>{return e||v.default.createElement("span",{style:{color:"#999999"}},0===t.status?(0,S.formatMessage)({id:"appPublish.table.versions.notSpecified"}):"-")}},{title:(0,S.formatMessage)({id:"appPublish.table.versions"}),dataIndex:"version",align:"left",render:(e,t)=>{var a=t.version_alias&&"(".concat(t.version_alias,")")||"";if(e){var s=t.app_version_info;return v.default.createElement(o.default,{style:{marginBottom:0},content:s?this.handleBox(s):(0,S.formatMessage)({id:"appPublish.table.versions.null"}),title:this.handleBox("".concat(e).concat(a))},v.default.createElement("div",{className:L.default.version},e,a))}return v.default.createElement("span",{style:{color:"#999999"}},(0,S.formatMessage)({id:"appPublish.table.versions.notSpecified"}))}},{title:(0,S.formatMessage)({id:"appPublish.table.scope"}),dataIndex:"scope",align:"center",render:(e,t)=>{var a=t&&t.scope_target&&t.scope_target.store_name,s="/enterprise/".concat(R.enterprise_id,"/shared/local");switch(e){case"":return v.default.createElement(g.Link,{to:s},(0,S.formatMessage)({id:"appPublish.table.scope.market"}));case"team":return v.default.createElement(g.Link,{to:s},(0,S.formatMessage)({id:"appPublish.table.scope.team_market"}));case"enterprise":return v.default.createElement(g.Link,{to:s},(0,S.formatMessage)({id:"appPublish.table.scope.enterprise_market"}));default:return v.default.createElement("p",{style:{marginBottom:0}},a||(0,S.formatMessage)({id:"appPublish.table.scope.app_shop"}))}}},{title:(0,S.formatMessage)({id:"appPublish.table.publishTime"}),align:"center",dataIndex:"create_time",render:e=>v.default.createElement("span",null,(0,b.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,S.formatMessage)({id:"appPublish.table.status"}),align:"center",dataIndex:"status",render:e=>{switch(e){case 0:return(0,S.formatMessage)({id:"appPublish.table.status.release"});case 1:return v.default.createElement("span",{style:{color:"green"}},(0,S.formatMessage)({id:"appPublish.table.status.release_finish"}));case 2:return v.default.createElement("span",{style:{color:"#999999"}},(0,S.formatMessage)({id:"appPublish.table.status.canceled"}))}return""}},{title:(0,S.formatMessage)({id:"appPublish.table.operate"}),width:"200px",dataIndex:"dataIndex",render:(e,t)=>{return v.default.createElement("div",null,0===t.status?v.default.createElement("div",null,v.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.continuePublish(t.record_id,t.step)}},(0,S.formatMessage)({id:"appPublish.table.btn.continue"})),v.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.cancelPublish(t.record_id)}},(0,S.formatMessage)({id:"appPublish.table.btn.release_cancel"}))):v.default.createElement(n.default,{title:(0,S.formatMessage)({id:"appPublish.table.btn.confirm_delete"}),onConfirm:()=>{this.deleteRecord(t.record_id)},okText:(0,S.formatMessage)({id:"appPublish.table.btn.confirm"}),cancelText:(0,S.formatMessage)({id:"appPublish.table.btn.cancel"})},v.default.createElement("a",{href:"#"},(0,S.formatMessage)({id:"appPublish.table.btn.delete"}))))}}]}))),v.default.createElement(_.default,{loading:f,dispatch:D,enterprise_id:R.enterprise_id,visible:h,onCancel:this.hideSelectStoreShow,onOk:this.handleSelectStore}))}},u=h))||u);t.default=N},TNXg:function(e,t,a){e.exports={version:"version___3lOXo"}},nvum:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var i=s(a("kLXV"));a("T2oS");var l=s(a("W9HT")),n=s(a("jehZ"));a("+L6B");var o=s(a("2/Rp"));a("OaEy");var p=s(a("2fM7"));a("y8nQ");var d,c,u,h=s(a("Vl3Y")),m=r(a("q1tI")),f=a("LLXN"),g=a("34ay"),b=s(a("e6Ls")),v=h.default.Item,S=p.default.Option,P=(d=h.default.create(),d((u=class extends m.PureComponent{constructor(e){super(e),this.getStoreList=(()=>{this.setState({loading:!0});var e=this.props,t=e.dispatch,a=e.enterprise_id;t({type:"enterprise/fetchEnterpriseStoreList",payload:{enterprise_id:a},callback:e=>{if(e){var t=e.list,a=void 0===t?[]:t,s=[];a.length>0&&(s=a.filter(e=>1===e.status&&(0,g.fetchMarketAuthority)(e,"Write"))),this.setState({storeList:s,loading:!1})}else this.setState({loading:!1})}})}),this.handleSubmit=(()=>{var e=this.props,t=e.onOk,a=e.form,s=a.validateFields;s((e,a)=>{!e&&t&&t(a)})}),this.state={loading:!0,storeList:[]}}componentDidMount(){this.getStoreList()}render(){var e=this.props,t=e.onCancel,a=e.visible,s=e.form,r=e.loading,d=void 0!==r&&r,c=s.getFieldDecorator,u=this.state,g=u.storeList,P=u.loading,_=g&&g.length>0&&g,M={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}};return m.default.createElement(i.default,{title:(0,f.formatMessage)({id:"appPublish.btn.record.makert.select.title"}),visible:a,className:b.default.TelescopicModal,onOk:this.handleSubmit,onCancel:t,footer:[m.default.createElement(o.default,{onClick:t}," ",(0,f.formatMessage)({id:"popover.cancel"})," "),_&&m.default.createElement(o.default,{type:"primary",onClick:this.handleSubmit,loading:d},(0,f.formatMessage)({id:"popover.confirm"}))]},_?m.default.createElement(h.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},m.default.createElement(v,(0,n.default)({},M,{label:(0,f.formatMessage)({id:"appPublish.btn.record.makert.select.store_id"})}),c("store_id",{initialValue:_[0].name||"",rules:[{required:!0,message:(0,f.formatMessage)({id:"placeholder.appShare.select.shop"})}]})(m.default.createElement(p.default,{getPopupContainer:e=>e.parentNode,placeholder:(0,f.formatMessage)({id:"placeholder.appShare.select.shop"})},_.map(e=>{var t=e.name,a=e.alias;return m.default.createElement(S,{key:"store".concat(t),value:t},a||t)}))),m.default.createElement("div",{className:b.default.conformDesc},(0,f.formatMessage)({id:"appPublish.btn.record.makert.select.store_id.desc"})))):P?m.default.createElement("div",{style:{textAlign:"center",marginBottom:"16px"}},m.default.createElement(l.default,{tip:(0,f.formatMessage)({id:"appPublish.btn.record.makert.select.loading"})})):m.default.createElement("p",{style:{textAlign:"center"}},(0,f.formatMessage)({id:"appPublish.btn.record.makert.select.desc"})))}},c=u))||c),_=P;t.default=_}}]);