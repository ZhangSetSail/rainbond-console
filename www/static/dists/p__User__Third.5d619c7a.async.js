(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[83],{"2+YD":function(e,t,s){"use strict";var a=s("g09b"),r=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("miYZ");var i,o,d,n=a(s("tsqr")),l=s("MuoO"),u=s("7DNP"),c=r(s("q1tI")),h=s("LLXN"),g=a(s("ALo4")),p=a(s("8+Sn")),f=a(s("4W9V")),_=a(s("QDog")),m=a(s("mWxT")),v="/user/login?disable_auto_login=true",w=(i=(0,l.connect)(),i((d=class extends c.Component{constructor(e){super(e),this.handleLoginUrl=(()=>{var e=this.props.dispatch;e(u.routerRedux.push(v))}),this.handleError=(e=>{var t=e&&e.status||e.response&&e.response.status;t&&500===t?n.default.warning((0,h.formatMessage)({id:"login.Third.again"})):(0,f.default)(e),setTimeout(()=>{this.handleLoginUrl()},1e3)}),this.handleSuccess=(()=>{var e=this.props.dispatch,t=window.localStorage.getItem("redirect");t&&""!==t||(t="/"),window.localStorage.setItem("redirect",""),t.startsWith("/")?e(u.routerRedux.push(t)):window.location.href=t}),this.state={resultState:"ing",title:(0,h.formatMessage)({id:"login.Third.authentication"}),desc:(0,h.formatMessage)({id:"login.Third.wait_for"})}}componentWillMount(){var e=m.default.OauthParameter("code"),t=m.default.OauthParameter("service_id"),s=this.props.dispatch;if(e&&t&&"None"!==e&&"None"!==t&&""!==e&&""!==t){var a=p.default.get("token");if(a)return s({type:"global/hideNeedLogin"}),s({type:"user/fetchThirdLoginBinding",payload:{code:e,service_id:t},callback:e=>{if(e){var t=e.response_data&&e.response_data.status;t&&400===t?this.setState({resultState:"error",title:(0,h.formatMessage)({id:"login.Third.Failed"}),desc:(0,h.formatMessage)({id:"login.Third.Authentication"})},()=>{setTimeout(()=>{this.handleLoginUrl()},1e3)}):e.status_code&&200===e.status_code?this.setState({resultState:"success",title:(0,h.formatMessage)({id:"login.Third.success"}),desc:""},()=>{e.bean&&e.bean.token&&p.default.set("token",e.bean.token),this.handleSuccess()}):this.handleLoginUrl()}else this.handleLoginUrl()},handleError:e=>{this.handleError(e)}}),null;_.default.removeCookie(),s({type:"user/fetchThirdCertification",payload:{code:e,service_id:t,domain:window.location.host},callback:e=>{if(e){var t=e.response_data&&e.response_data.status;if(!t||400!==t&&401!==t&&404!==t)if(200===e.status_code){var a=e.bean;if(a&&a.token)return p.default.set("token",a.token),this.handleSuccess(),null;a&&a.result&&(a.result.is_authenticated?s(u.routerRedux.push("/user/third/login?code=".concat(a.result.code,"&service_id=").concat(a.result.service_id,"&oauth_user_id=").concat(a.result.oauth_user_id,"&oauth_type=").concat(a.result.oauth_type))):s(u.routerRedux.push("/user/third/register?code=".concat(a.result.code,"&service_id=").concat(a.result.service_id,"&oauth_user_id=").concat(a.result.oauth_user_id,"&oauth_type=").concat(a.result.oauth_type))))}else this.handleLoginUrl();else this.setState({resultState:"error",title:(0,h.formatMessage)({id:"login.Third.Failed"}),desc:e.msg_show||(0,h.formatMessage)({id:"login.Third.token"})},()=>{setTimeout(()=>{this.handleLoginUrl()},1e3)})}else this.handleLoginUrl()},handleError:e=>{this.handleError(e)}})}else _.default.removeCookie(),s(u.routerRedux.replace(v))}render(){var e=this.state,t=e.resultState,s=e.title,a=e.desc;return c.default.createElement("div",{style:{paddingTop:"20%",paddingBottom:16}},c.default.createElement(g.default,{type:t,title:s,description:a}))}},o=d))||o);t.default=w}}]);