(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[63],{"3jFV":function(e,t,a){"use strict";var l=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=l(a("kLXV"));a("T2oS");var n=l(a("W9HT"));a("5Dmo");var r=l(a("3S7+"));a("5NDa");var o=l(a("5rEg"));a("sRBo");var d=l(a("kaz8"));a("14J3");var c=l(a("BMrR"));a("jCWc");var p=l(a("kPKH")),u=l(a("jehZ"));a("+L6B");var m=l(a("2/Rp"));a("/xke");var h=l(a("TeRw")),f=l(a("p0pE"));a("OaEy");var g=l(a("2fM7"));a("y8nQ");var v,E,_,y,C=l(a("Vl3Y")),b=a("CC/n"),N=a("DrY4"),M=a("MuoO"),S=a("7DNP"),k=i(a("q1tI")),T=a("LLXN"),w=l(a("lpA0")),x=l(a("QDog")),D=l(a("qCJ4")),A=l(a("e6Ls")),L=l(a("Kia0")),O=C.default.Item,I=g.default.Option,R=(v=C.default.create(),E=(0,M.connect)(e=>{var t=e.user,a=e.enterprise,l=e.application;return{currentUser:t.currentUser,currentEnterprise:a.currentEnterprise,groupDetail:l.groupDetail||{}}}),v(_=E((y=class extends k.PureComponent{constructor(e){super(e),this.onAddGroup=(()=>{this.setState({addGroup:!0})}),this.onSelectChange=(e=>{this.handleOpenLoging();var t=this.props.form,a=this.state.userTeamList,l=t.setFieldsValue,i=a.filter(t=>t.name===e);i&&(i.length>0?this.fetchTeamApps(i[0].value[0],i[0].value[1]):(this.handleCloseLoging(),l({apps:""})))}),this.onGroupChange=(e=>{var t=this.state.checkAllList;this.setState({checkedList:e,indeterminate:!!e.length&&e.length<t.length,checkAll:e.length===t.length})}),this.onCheckAllChange=(e=>{var t=this.state.checkAllList;this.setState({checkedList:e.target.checked?t:[],indeterminate:!1,checkAll:e.target.checked})}),this.getUserTeams=(()=>{var e=this.props,t=e.dispatch,a=e.currentEnterprise;t({type:"global/fetchMyTeams",payload:{enterprise_id:a.enterprise_id,page:1,page_size:999},callback:e=>{if(e&&200===e.status_code){var t=e.list,a=[];t&&t.length>0&&t.map(e=>{e.region_list.map(t=>{var l={name:"".concat(e.team_alias," | ").concat(t.region_alias),value:[e.team_name,t.region_name]};a.push(l)})}),this.setState({userTeamList:a})}}})}),this.handleOpenLoging=(()=>{this.setState({Loading:!0,loading:!0})}),this.handleCloseLoging=(()=>{this.setState({Loading:!1,loading:!1})}),this.cancelAddGroup=(()=>{this.setState({addGroup:!1})}),this.fetchCopyComponent=(()=>{var e=this.props,t=e.dispatch,a=e.groupDetail;t({type:"application/fetchCopyComponent",payload:{tenantName:x.default.getCurrTeamName(),group_id:a.app_id},callback:e=>{if(e&&200===e.status_code){var t=e.list,a=[];t&&t.length>0&&t.map((e,t)=>{a.push(t)}),this.setState({checkAllList:a,checkedList:a,dataSource:e.list,loading:!1,Loading:!1})}}})}),this.handleAddGroup=(e=>{var t=this.props.form.getFieldValue,a=this.state.userTeamList,l=t("teamRegion"),i=a.filter(e=>e.name===l),s="",n="";i.length>0&&(s=i&&i[0].value[0],n=i&&i[0].value[1]),this.handleOpenLoging(),(0,b.addGroup)((0,f.default)({team_name:s||x.default.getCurrTeamName(),region_name:n||x.default.getCurrRegionName()},e)).then(e=>{e&&(this.fetchTeamApps(s,n,e.bean.group_id),this.cancelAddGroup())}).finally(()=>{this.handleCloseLoging()})}),this.fetchTeamApps=((e,t,a)=>{var l=this.props.form,i=l.setFieldsValue;(0,N.getTeamRegionGroups)({query:"",team_name:e||x.default.getCurrTeamName(),region_name:t||x.default.getCurrRegionName(),noModels:!0}).then(t=>{var l=t&&t.list||[];e&&i({apps:a||(l.length>0?l[0].group_id:"")}),this.setState({apps:l}),this.handleCloseLoging()}).catch(()=>{this.handleCloseLoging()})}),this.handleSubmit=(()=>{var e=this.state.checkedList;this.props.form.validateFields((t,a)=>{t||(e&&e.length>20?h.default.warning({message:(0,T.formatMessage)({id:"notification.warn.app_copy_max20"})}):(this.setState({Loading:!0}),this.AddCopyTeamApps(a)))})}),this.AddCopyTeamApps=(e=>{var t=this.props,a=t.dispatch,l=t.groupDetail,i=t.onCancel,s=this.state,n=s.dataSource,r=s.checkedList,o=s.userTeamList,d={},c=e.apps,p=e.teamRegion;d.tar_group_id=c;var u=o.filter(e=>e.name===p);d.tar_team_name=u&&u[0].value[0],d.tar_region_name=u&&u[0].value[1];var m=[];r.map(e=>{var t=n[e],a=t.service_id,l=t.build_source,i=l.code_version,s=l.version,r=w.default.isCodeAppByBuildSource(l),o=r?i:s,d={service_id:a,change:{build_source:{version:o}}};m.push(d)}),d.services=m,a({type:"application/addCopyTeamApps",payload:(0,f.default)({tenantName:x.default.getCurrTeamName(),group_id:l.app_id},d),callback:e=>{if(this.handleCloseLoading(),e&&200===e.status_code){h.default.success({message:(0,T.formatMessage)({id:"notification.success.copy"})});var t=e.bean,l=t.tar_team_name,s=t.tar_region_name,n=t.tar_group_id;a(S.routerRedux.push("/team/".concat(l,"/region/").concat(s,"/apps/").concat(n))),i()}},handleError:e=>{e&&e.data&&e.data.msg_show&&h.default.warning({message:e.data.msg_show}),this.handleCloseLoading()}})}),this.handleCloseLoading=(()=>{this.setState({Loading:!1,loading:!1})}),this.handleSave=(e=>{var t=[...this.state.dataSource],a=t.findIndex(t=>e.service_id===t.service_id),l=t[a];t.splice(a,1,(0,f.default)({},l,e)),this.setState({dataSource:t})}),this.handleOverDiv=(e=>{return k.default.createElement("div",null,e)}),this.checkTeams=((e,t,a)=>{t&&0===t.length||!t?a("\u8bf7\u9009\u62e9\u56e2\u961f/\u96c6\u7fa4"):t&&1===t.length?a("\u8bf7\u9009\u62e9\u96c6\u7fa4"):a()}),this.save=((e,t,a)=>{var l=t?"code_version":"version",i=e;i.build_source[l]=a,this.handleSave((0,f.default)({},i))}),this.state={userTeamList:[],Loading:!0,loading:!0,dataSource:[],apps:[],checkedList:[],checkAllList:[],indeterminate:!1,checkAll:!0,addGroup:!1}}componentDidMount(){this.fetchCopyComponent(),this.getUserTeams(),this.fetchTeamApps()}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.form,i=e.groupDetail,h=l.getFieldDecorator,f=this.state,v=f.userTeamList,E=f.dataSource,_=f.checkedList,y=f.apps,b=f.loading,N=f.Loading,M=f.addGroup,S=f.indeterminate,R=f.checkAll,B=v&&v.length>0&&v,G="",P=x.default.getCurrTeamName(),V=x.default.getCurrRegionName();B&&v.map(e=>{e.value[0]===P&&e.value[1]===V&&(G=e.name)});var F=y&&y.length>0&&y,H=_&&_.length>0,K={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:17}}};return k.default.createElement(s.default,{className:A.default.TelescopicModal,onOk:this.handleSubmit,title:t,width:1200,visible:!0,onCancel:a,footer:[k.default.createElement(m.default,{onClick:a}," ",(0,T.formatMessage)({id:"popover.cancel"})," "),k.default.createElement(m.default,{type:"primary",style:{marginTop:"20px"},disabled:!H,loading:N,onClick:this.handleSubmit},(0,T.formatMessage)({id:"popover.confirm"}))]},k.default.createElement(n.default,{spinning:b,tip:"Loading..."},k.default.createElement("div",{className:L.default.copyBox},M&&k.default.createElement(D.default,{copyFlag:this.props.copyFlag,isAddGroup:!1,loading:b,onCancel:this.cancelAddGroup,onOk:this.handleAddGroup}),k.default.createElement(C.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},k.default.createElement(c.default,null,B&&k.default.createElement(p.default,{span:6},k.default.createElement(O,(0,u.default)({},K,{label:(0,T.formatMessage)({id:"confirmModal.app.label.teamRegion"})}),h("teamRegion",{initialValue:G,rules:[{required:!0,validator:this.checkTeams}]})(k.default.createElement(g.default,{getPopupContainer:e=>e.parentNode,onChange:this.onSelectChange,placeholder:(0,T.formatMessage)({id:"placeholder.copy.team_region"})},B.map(e=>{return k.default.createElement(I,{value:e.name},e.name)}))))),k.default.createElement(p.default,{span:10,style:{display:"flex",alignItems:"center"}},k.default.createElement(O,(0,u.default)({},K,{label:""}),h("apps",{initialValue:i.app_id,rules:[{required:!0,message:(0,T.formatMessage)({id:"placeholder.app"})}]})(k.default.createElement(g.default,{getPopupContainer:e=>e.parentNode,style:{width:"180px"},placeholder:(0,T.formatMessage)({id:"placeholder.app"})},F&&F.map(e=>k.default.createElement(I,{key:e.group_id,value:e.group_id},e.group_name))))),k.default.createElement(m.default,{style:{margin:"0 0 24px 10px"},onClick:this.onAddGroup},(0,T.formatMessage)({id:"popover.newApp.title"}))))),k.default.createElement("div",{className:L.default.tabTitle},k.default.createElement("div",{className:"".concat(L.default.w300," ").concat(L.default.over)},k.default.createElement(d.default,{indeterminate:S,onChange:this.onCheckAllChange,checked:R},(0,T.formatMessage)({id:"popover.newComponent.componentName"}))),k.default.createElement("div",{className:"".concat(L.default.w500," ").concat(L.default.over)},(0,T.formatMessage)({id:"confirmModal.app.label.build"})),k.default.createElement("div",{className:"".concat(L.default.w300," ").concat(L.default.over)},(0,T.formatMessage)({id:"confirmModal.app.label.editVersions"}))),k.default.createElement(d.default.Group,{style:{width:"100%"},value:_,onChange:this.onGroupChange},E.map((e,t)=>{var a=e.service_cname,l=e.build_source,i=e.service_id,s=l||{},n=s.code_version,c=s.version,p=s.image,u=s.git_url,m=s.package_name,f=s.rain_app_name,v=s.service_source,E=w.default.isImageAppByBuildSource(l),_=w.default.isMarketAppByBuildSource(l),y=w.default.isCodeAppByBuildSource(l),C=w.default.isUploadFilesAppSource(l),b=y?n:c,N="third_party"===v,M=E?p:y?u:_?f:C?m:"",S="",x=k.default.createElement(g.default,{getPopupContainer:e=>e.parentNode,style:{width:90},defaultValue:E?"Tag":"branch"},!E&&k.default.createElement(I,{value:"branch"},(0,T.formatMessage)({id:"confirmModal.app.label.branch"})),y&&k.default.createElement(I,{value:"Tag"},(0,T.formatMessage)({id:"confirmModal.app.label.tag"})));return S=E||y?k.default.createElement(O,null,h(i,{initialValue:b||"",rules:[{required:!0,message:(0,T.formatMessage)({id:"placeholder.copy.not_null"})}]})(k.default.createElement(o.default,{addonBefore:x,onPressEnter:t=>{this.save(e,y,t.target.value)},onBlur:t=>{this.save(e,y,t.target.value)},style:{width:"268px"}}))):N?"-":(0,T.formatMessage)({id:"confirmModal.app.label.not_change"}),k.default.createElement("div",{className:L.default.tabTr,key:i},k.default.createElement(r.default,{title:a},k.default.createElement("div",{className:"".concat(L.default.w300," ").concat(L.default.over)},k.default.createElement(d.default,{value:t},a))),k.default.createElement(r.default,{title:N?(0,T.formatMessage)({id:"confirmModal.app.label.third_party"}):M},k.default.createElement("div",{className:"".concat(L.default.w500," ").concat(L.default.over)},k.default.createElement("div",{style:{paddingRight:"5px",width:"100px",color:"rgba(0, 0, 0, 0.85)"}},E?(0,T.formatMessage)({id:"confirmModal.app.label.mirror_image"}):y?(0,T.formatMessage)({id:"confirmModal.app.label.sound_code"}):_?(0,T.formatMessage)({id:"confirmModal.app.label.component_library"}):N?(0,T.formatMessage)({id:"confirmModal.app.label.third_party"}):C?(0,T.formatMessage)({id:"confirmModal.app.label.local"}):""),k.default.createElement("div",{className:"".concat(L.default.w380," ").concat(L.default.over)},N?"-":M))),k.default.createElement("div",{className:"".concat(L.default.w300," ").concat(L.default.over),style:{height:"80px"}},S))})))))}},_=y))||_)||_);t.default=R},CfDn:function(e,t,a){"use strict";var l=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,n,r,o=l(a("jehZ")),d=l(a("QDog")),c=l(a("hMqj")),p=a("MuoO"),u=i(a("q1tI")),m=l(a("Z0Jj")),h=(l(a("t3BL")),s=(0,p.connect)(e=>{var t=e.teamControl,a=e.application;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo,groupDetail:a.groupDetail||{}}},null,null,{pure:!1}),s((r=class extends u.PureComponent{constructor(e){super(e),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return c.default.querySpecifiedPermissionsInfo(t,e)}),this.state={currApp:{},loading:!0,appID:this.getGroupId(),operationPermissions:this.handlePermissions("queryControlInfo"),appPermissions:this.handlePermissions("queryAppInfo"),appConfigGroupPermissions:this.handlePermissions("queryAppConfigGroupInfo"),componentPermissions:this.handlePermissions("queryComponentInfo")}}componentWillMount(){var e=this.props.dispatch,t=this.state.appPermissions.isAccess;t||d.default.withoutPermission(e)}getGroupId(){var e=this.props.match.params;return e.appID}render(){var e=this.props.groupDetail;return u.default.createElement(u.Fragment,null,"{}"===JSON.stringify(e)?u.default.createElement(m.default,(0,o.default)({},this.props,this.state)):(e.app_type,u.default.createElement(m.default,(0,o.default)({},this.props,this.state))))}},n=r))||n);t.default=h},Kia0:function(e,t,a){e.exports={tabTitle:"tabTitle___2CONk",tabTr:"tabTr___3iaGW",w500:"w500___orTyB",w300:"w300___1jikJ",w380:"w380___OrUuz",over:"over___3at-n"}},Z0Jj:function(e,t,a){"use strict";var l=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=l(a("kLXV"));a("7Kak");var n=l(a("9yH6"));a("jCWc");var r=l(a("kPKH"));a("14J3");var o=l(a("BMrR"));a("T2oS");var d=l(a("W9HT"));a("5Dmo");var c=l(a("3S7+"));a("/zsF");var p=l(a("PArb"));a("+L6B");var u=l(a("2/Rp"));a("Pwec");var m=l(a("CtXQ"));a("/xke");var h,f,g,v=l(a("TeRw")),E=l(a("jehZ")),_=l(a("qCJ4")),y=l(a("4SMx")),C=l(a("ri62")),b=l(a("18gR")),N=a("RBnf"),M=a("MuoO"),S=a("7DNP"),k=l(a("wd/R")),T=i(a("q1tI")),w=a("LLXN"),x=l(a("Jxxo")),D=l(a("q76B")),A=l(a("3jFV")),L=l(a("YCtL")),O=l(a("ZShK")),I=a("xpXo"),R=l(a("8+Sn")),B=l(a("QDog")),G=l(a("mWxT")),P=l(a("ZgmS")),V=l(a("i+gw")),F=l(a("T0wR")),H=l(a("Zob5")),K=l(a("0fGy")),U=l(a("Mw2C")),z=l(a("puIC")),q=(h=(0,M.connect)(e=>{var t=e.user,a=e.application,l=e.teamControl,i=e.enterprise,s=e.loading,n=e.global;return{buildShapeLoading:s.effects["global/buildShape"],editGroupLoading:s.effects["application/editGroup"],deleteLoading:s.effects["application/delete"],currUser:t.currentUser,apps:a.apps,groupDetail:a.groupDetail||{},currentTeam:l.currentTeam,currentRegionName:l.currentRegionName,currentEnterprise:i.currentEnterprise,novices:n.novices}}),h((g=class extends T.PureComponent{constructor(e){var t;super(e),t=this,this.onCancel=(()=>{this.setState({customSwitch:!1})}),this.closeTimer=(()=>{this.timer&&clearInterval(this.timer)}),this.loading=(()=>{this.fetchAppDetail(),this.loadTopology(!0),this.fetchAppDetailState()}),this.handleNewbieGuiding=(e=>{var t=e.nextStep;return T.default.createElement(b.default,(0,E.default)({},e,{totals:2,handleClose:()=>{this.handleGuideStep("close")},handleNext:()=>{t&&(document.getElementById("scroll_div").scrollIntoView(),this.handleGuideStep(t))}}))}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.handleError=(e=>{var t=this.state.componentTimer;if(!t)return null;e&&e.data&&e.data.msg_show&&v.default.warning({message:(0,w.formatMessage)({id:"notification.warn.error"}),description:e.data.msg_show})}),this.handleTimers=((e,t,a)=>{var l=this.state.componentTimer;if(!l)return null;this[e]=setTimeout(()=>{t()},a)}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,l=t.regionName,i=t.appID;e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:l,group_id:i},callback:e=>{e&&200===e.status_code&&this.setState({currApp:e.bean})},handleError:t=>{var a=this.state.componentTimer;if(!a)return null;t&&404===t.code&&e(S.routerRedux.push("/team/".concat(B.default.getCurrTeamName(),"/region/").concat(B.default.getCurrRegionName(),"/index")))}})}),this.handleWaitLevel=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,l=t.appID;e({type:"application/fetchToupgrade",payload:{team_name:a,group_id:l},callback:e=>{var t=e&&e.bean||{};this.setState({upgradableNumLoading:!1,upgradableNum:t&&t.upgradable_num||0})}})}),this.fetchAppDetailState=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,l=t.appID;e({type:"application/fetchAppDetailState",payload:{team_name:a,group_id:l},callback:e=>{this.setState({resources:e.list,appStatusConfig:!0})}})}),this.handleFormReset=(()=>{var e=this.props.form;e.resetFields(),this.loadApps()}),this.handleSearch=(e=>{e.preventDefault(),this.loadApps()}),this.changeType=(e=>{this.setState({type:e})}),this.toDelete=(()=>{this.closeComponentTimer(),this.setState({toDelete:!0})}),this.cancelDelete=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.setState({toDelete:!1}),e&&t.openComponentTimer()},this.closeComponentTimer=(()=>{this.setState({componentTimer:!1}),this.closeTimer()}),this.openComponentTimer=(()=>{this.setState({componentTimer:!0},()=>{this.loadTopology(!0)})}),this.handleDelete=(()=>{var e=this.props.dispatch;e({type:"application/delete",payload:{team_name:B.default.getCurrTeamName(),group_id:this.getGroupId()},callback:t=>{t&&200===t.status_code&&(v.default.success({message:(0,w.formatMessage)({id:"notification.success.delete"})}),this.closeComponentTimer(),this.cancelDelete(!1),e(S.routerRedux.replace("/team/".concat(B.default.getCurrTeamName(),"/region/").concat(B.default.getCurrRegionName(),"/index"))))}})}),this.newAddress=(e=>{this.props.dispatch({type:"global/fetchGroups",payload:{team_name:B.default.getCurrTeamName()},callback:t=>{t&&t.length?e==t[0].group_id?this.newAddress(e):this.props.dispatch(S.routerRedux.push("/team/".concat(B.default.getCurrTeamName(),"/region/").concat(B.default.getCurrRegionName(),"/apps/").concat(t[0].group_id))):this.props.dispatch(S.routerRedux.push("/team/".concat(B.default.getCurrTeamName(),"/region/").concat(B.default.getCurrRegionName(),"/index")))}})}),this.toEdit=(()=>{this.setState({toEdit:!0})}),this.cancelEdit=(()=>{this.setState({toEdit:!1})}),this.handleToEditAppDirector=(()=>{this.setState({toEditAppDirector:!0})}),this.cancelEditAppDirector=(()=>{this.setState({toEditAppDirector:!1})}),this.handleEdit=(e=>{var t=this.props.dispatch;t({type:"application/editGroup",payload:{team_name:B.default.getCurrTeamName(),group_id:this.getGroupId(),group_name:e.group_name,note:e.note,username:e.username,logo:e.logo,k8s_app:e.k8s_app},callback:e=>{e&&200===e.status_code&&(v.default.success({message:(0,w.formatMessage)({id:"notification.success.change"})}),t({type:"application/editGroups",payload:{team_name:B.default.getCurrTeamName(),group_id:this.getGroupId()},callback:e=>{v.default.success({message:(0,w.formatMessage)({id:"notification.success.takeEffect"})})}})),this.handleUpDataHeader(),this.cancelEdit(),this.cancelEditAppDirector(),this.fetchAppDetail(),t({type:"global/fetchGroups",payload:{team_name:B.default.getCurrTeamName()}})}})}),this.handleUpDataHeader=(()=>{var e=this.props.dispatch;e({type:"global/IsUpDataHeader",payload:{isUpData:!0}})}),this.handleTopology=(e=>{this.setState({promptModal:!0,code:e})}),this.handleOpenRapidCopy=(()=>{this.setState({rapidCopy:!0})}),this.handleCloseRapidCopy=(()=>{this.setState({rapidCopy:!1})}),this.handlePromptModalOpen=(()=>{var e=this.state,t=e.code,a=e.serviceIds,l=this.props.dispatch;"restart"===t?(0,I.batchOperation)({action:t,team_name:B.default.getCurrTeamName(),serviceIds:a&&a.join(",")}).then(e=>{e&&200===e.status_code&&(v.default.success({message:(0,w.formatMessage)({id:"notification.success.reboot_success"})}),this.handlePromptModalClose()),this.loadTopology(!1)}):l({type:"global/buildShape",payload:{tenantName:B.default.getCurrTeamName(),group_id:this.getGroupId(),action:t},callback:e=>{e&&200===e.status_code&&(v.default.success({message:e.msg_show||(0,w.formatMessage)({id:"notification.success.build_success"}),duration:"3"}),this.handlePromptModalClose()),this.loadTopology(!1)}})}),this.handlePromptModalClose=(()=>{this.setState({promptModal:!1,code:""})}),this.handleSizeChange=(e=>{this.setState({size:e.target.value})}),this.handleSwitch=(()=>{this.setState({customSwitch:!0})}),this.handleJump=(e=>{var t=this.props,a=t.dispatch,l=t.appID;a(S.routerRedux.push("/team/".concat(B.default.getCurrTeamName(),"/region/").concat(B.default.getCurrRegionName(),"/apps/").concat(l,"/").concat(e)))}),this.heightOnchage=(e=>{e?this.setState({flagHeight:!1,iframeHeight:"500px"}):this.setState({flagHeight:!0,iframeHeight:"70vh"})}),this.state={type:"shape",toDelete:!1,toEdit:!1,toEditAppDirector:!1,service_alias:[],serviceIds:[],linkList:[],jsonDataLength:0,promptModal:!1,code:"",size:"large",currApp:{},rapidCopy:!1,componentTimer:!0,customSwitch:!1,resources:{},upgradableNum:0,upgradableNumLoading:!0,appStatusConfig:!1,guideStep:1,aggregation:!1,common:!0,compile:!1,flagHeight:!1,iframeHeight:"500px",language:"zh-CN"===R.default.get("language")}}componentDidMount(){this.loading(),this.handleWaitLevel()}componentWillUnmount(){this.closeTimer();var e=this.props.dispatch;e({type:"application/clearGroupDetail"})}getGroupId(){return this.props.appID}loadTopology(e){var t=this.props.dispatch,a=B.default.getCurrTeamName(),l=B.default.getCurrRegionName();R.default.set("team_name",a),R.default.set("region_name",l),t({type:"global/fetAllTopology",payload:{region_name:l,team_name:a,groupId:this.getGroupId()},callback:t=>{if(t&&200===t.status_code){var a=t.bean;if("{}"===JSON.stringify(a))return;var l=[],i=[],s=a.json_data;Object.keys(s).map(e=>{l.push(e),"running"==s[e].cur_status&&1==s[e].is_internet&&i.push(s[e].service_alias)}),this.setState({jsonDataLength:Object.keys(s).length,service_alias:i,serviceIds:l},()=>{this.loadLinks(i.join("-"),e)})}}})}loadLinks(e,t){var a=this.props.dispatch;a({type:"global/queryLinks",payload:{service_alias:e,team_name:B.default.getCurrTeamName()},callback:e=>{e&&200===e.status_code&&this.setState({linkList:e.list||[]},()=>{t&&this.handleTimers("timer",()=>{this.fetchAppDetailState(),this.fetchAppDetail(),this.loadTopology(!0)},1e4)})},handleError:e=>{this.handleError(e),this.handleTimers("timer",()=>{this.fetchAppDetailState(),this.fetchAppDetail(),this.loadTopology(!0)},2e4)}})}render(){var e=this.props,t=e.groupDetail,a=e.appPermissions,l=a.isShare,i=a.isBackup,h=a.isUpgrade,f=a.isEdit,g=a.isDelete,v=a.isStart,E=a.isStop,b=a.isUpdate,M=a.isConstruct,S=a.isCopy,I=e.buildShapeLoading,R=e.editGroupLoading,q=e.deleteLoading,j=e.novices,Y=e.appConfigGroupPermissions.isAccess,J=e.componentPermissions,X=e.operationPermissions.isAccess,W=e.componentPermissions,Z=W.isAccess,Q=W.isCreate,$=W.isConstruct,ee=W.isRestart,te=this.state,ae=te.currApp,le=te.resources,ie=te.rapidCopy,se=te.jsonDataLength,ne=te.linkList,re=te.code,oe=te.promptModal,de=te.toEdit,ce=te.toEditAppDirector,pe=te.toDelete,ue=te.type,me=te.customSwitch,he=te.serviceIds,fe=te.upgradableNumLoading,ge=te.upgradableNum,ve=te.appStatusConfig,Ee=te.guideStep,_e=te.aggregation,ye=te.common,Ce=te.compile,be=te.flagHeight,Ne=te.iframeHeight,Me=te.language,Se={start:(0,w.formatMessage)({id:"appOverview.btn.start"}),restart:(0,w.formatMessage)({id:"appOverview.list.table.restart"}),stop:(0,w.formatMessage)({id:"appOverview.btn.stop"}),deploy:(0,w.formatMessage)({id:"appOverview.btn.build"})},ke=!(se>0),Te={marginRight:"10px"},we=T.default.createElement("div",{className:z.default.pageHeaderContent},T.default.createElement("div",{className:z.default.contentl},T.default.createElement("div",{className:z.default.conBoxt},T.default.createElement("div",{className:z.default.contentTitle},T.default.createElement("span",null,ae.group_name||"-"),T.default.createElement(m.default,{style:{cursor:"pointer",marginLeft:"5px"},onClick:this.toEdit,type:"edit"})),le.status&&T.default.createElement("div",{className:z.default.extraContent},"CLOSED"!==le.status&&b&&T.default.createElement(u.default,{style:Te,onClick:()=>{this.handleTopology("upgrade")},disabled:ke},(0,w.formatMessage)({id:"appOverview.btn.update"})),M&&$&&T.default.createElement(u.default,{style:Te,disabled:ke,onClick:()=>{this.handleTopology("deploy")}},(0,w.formatMessage)({id:"appOverview.btn.build"})),S&&T.default.createElement(u.default,{style:Te,disabled:ke,onClick:this.handleOpenRapidCopy},(0,w.formatMessage)({id:"appOverview.btn.copy"})),ne.length>0&&T.default.createElement(L.default,{linkList:ne}))),T.default.createElement("div",{className:z.default.content_Box},ve&&T.default.createElement(x.default,{AppStatus:le.status}),le.status&&v&&T.default.createElement("span",null,T.default.createElement("a",{onClick:()=>{this.handleTopology("start")},disabled:ke},(0,w.formatMessage)({id:"appOverview.btn.start"})),T.default.createElement(p.default,{type:"vertical"})),le.status&&("ABNORMAL"===le.status||"PARTIAL_ABNORMAL"===le.status)&&he&&he.length>0&&ee&&T.default.createElement("span",null,T.default.createElement("a",{onClick:()=>{this.handleTopology("restart")},disabled:ke},(0,w.formatMessage)({id:"appOverview.list.table.restart"})),T.default.createElement(p.default,{type:"vertical"})),g&&"RUNNING"!==le.status&&T.default.createElement("a",{onClick:this.toDelete},(0,w.formatMessage)({id:"appOverview.list.table.delete"})),le.status&&"CLOSED"!==le.status&&E&&T.default.createElement("span",null,"RUNNING"!==le.status&&T.default.createElement(p.default,{type:"vertical"}),T.default.createElement("a",{onClick:()=>{this.handleTopology("stop")}},(0,w.formatMessage)({id:"appOverview.btn.stop"})))),T.default.createElement("div",{className:z.default.connect_Bot},T.default.createElement("div",{className:z.default.connect_Box},T.default.createElement("div",{className:z.default.connect_Boxs},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.memory"})),T.default.createElement("div",null,"".concat(P.default.unit(le.memory||0,"MB")))),T.default.createElement("div",{className:z.default.connect_Boxs},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.cpu"})),T.default.createElement("div",null,le.cpu&&le.cpu/1e3||0,"Core"))),T.default.createElement("div",{className:z.default.connect_Box},T.default.createElement("div",{className:z.default.connect_Boxs},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.disk"})),T.default.createElement("div",null,"".concat(P.default.unit(le.disk||0,"KB")))),T.default.createElement("div",{className:z.default.connect_Boxs},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.componentNum"})),T.default.createElement("div",null,ae.service_num||0))))),T.default.createElement("div",{className:z.default.contentr},T.default.createElement("div",{className:z.default.conrHeader},T.default.createElement("div",null,T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.createTime"})),T.default.createElement("span",null,ae.create_time?(0,k.default)(ae.create_time).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"):"-")),T.default.createElement("div",null,T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.updateTime"})),T.default.createElement("span",null,ae.update_time?(0,k.default)(ae.update_time).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"):"-"))),T.default.createElement("div",{className:z.default.conrHeader},T.default.createElement("div",{style:{display:"flex",alignItems:"center"}},T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.govern"})),T.default.createElement("span",{style:Me?{}:{display:"inline-block"}},!ae.governance_mode||"BUILD_IN_SERVICE_MESH"!==ae.governance_mode&&"KUBERNETES_NATIVE_SERVICE"!==ae.governance_mode?ae.governance_mode:B.default.fetchGovernanceMode(ae.governance_mode)),ae.governance_mode&&f&&T.default.createElement("a",{style:{marginLeft:"5px"},onClick:this.handleSwitch},(0,w.formatMessage)({id:"appOverview.btn.change"}))),T.default.createElement("div",null,T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.principal"})),T.default.createElement("span",null,ae.principal?T.default.createElement(c.default,{placement:"top",title:T.default.createElement("div",null,T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.principal.username"}),ae.username),T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.principal.principal"}),ae.principal),T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.principal.email"}),ae.email))},T.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)"}},ae.principal)):"-",f&&T.default.createElement(m.default,{style:{cursor:"pointer",marginLeft:"5px"},onClick:this.handleToEditAppDirector,type:"edit"})))),T.default.createElement("div",{className:Me?z.default.conrBot:z.default.en_conrBot},T.default.createElement("div",{className:z.default.conrBox},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.backups"})),T.default.createElement("div",{onClick:()=>{i&&this.handleJump("backup")}},T.default.createElement("a",null,ae.backup_num||0))),T.default.createElement("div",{className:z.default.conrBox},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.modelRelease"})),T.default.createElement("div",{onClick:()=>{l&&this.handleJump("publish")}},T.default.createElement("a",null,ae.share_num||0))),T.default.createElement("div",{className:z.default.conrBox},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.gateway"})),T.default.createElement("div",{onClick:()=>{X&&this.handleJump("gateway")}},T.default.createElement("a",null,ae.ingress_num||0))),T.default.createElement("div",{className:z.default.conrBox},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.upgrade"})),T.default.createElement("div",{onClick:()=>{!fe&&h&&this.handleJump("upgrade")}},T.default.createElement("a",null,fe?T.default.createElement(d.default,null):ge))),T.default.createElement("div",{className:z.default.conrBox},T.default.createElement("div",null,(0,w.formatMessage)({id:"appOverview.config"})),T.default.createElement("div",{onClick:()=>{Y&&this.handleJump("configgroups")}},T.default.createElement("a",null,ae.config_group_num||0)))))),xe=T.default.createElement("div",{className:z.default.pageHeaderContents},T.default.createElement("div",{className:z.default.contentl},T.default.createElement("div",{className:z.default.conBoxt},T.default.createElement("div",{className:z.default.contentTitle},T.default.createElement("span",null,ae.group_name||"-"),T.default.createElement(m.default,{style:{cursor:"pointer",marginLeft:"5px"},onClick:this.toEdit,type:"edit"})),T.default.createElement("div",{className:z.default.content_Box},ve&&T.default.createElement(x.default,{AppStatus:le.status}),le.status&&v&&T.default.createElement("span",null,T.default.createElement("a",{onClick:()=>{this.handleTopology("start")},disabled:ke},(0,w.formatMessage)({id:"appOverview.btn.start"})),T.default.createElement(p.default,{type:"vertical"})),le.status&&("ABNORMAL"===le.status||"PARTIAL_ABNORMAL"===le.status)&&he&&he.length>0&&ee&&T.default.createElement("span",null,T.default.createElement("a",{onClick:()=>{this.handleTopology("restart")},disabled:ke},(0,w.formatMessage)({id:"appOverview.list.table.restart"})),T.default.createElement(p.default,{type:"vertical"})),g&&"RUNNING"!==le.status&&T.default.createElement("a",{onClick:this.toDelete},(0,w.formatMessage)({id:"appOverview.list.table.delete"})),le.status&&"CLOSED"!==le.status&&E&&T.default.createElement("span",null,"RUNNING"!==le.status&&T.default.createElement(p.default,{type:"vertical"}),T.default.createElement("a",{onClick:()=>{this.handleTopology("stop")}},(0,w.formatMessage)({id:"appOverview.btn.stop"})))),le.status&&T.default.createElement("div",{className:z.default.extraContent},"CLOSED"!==le.status&&b&&T.default.createElement(u.default,{style:Te,onClick:()=>{this.handleTopology("upgrade")},disabled:ke},(0,w.formatMessage)({id:"appOverview.btn.update"})),M&&$&&T.default.createElement(u.default,{style:Te,disabled:ke,onClick:()=>{this.handleTopology("deploy")}},(0,w.formatMessage)({id:"appOverview.btn.build"})),S&&T.default.createElement(u.default,{style:Te,disabled:ke,onClick:this.handleOpenRapidCopy},(0,w.formatMessage)({id:"appOverview.btn.copy"})),ne.length>0&&T.default.createElement(L.default,{linkList:ne})))),T.default.createElement("div",{className:z.default.contentr},T.default.createElement("div",{className:z.default.conrHeader},T.default.createElement("div",null,T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.createTime"})),T.default.createElement("span",null,ae.create_time?(0,k.default)(ae.create_time).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"):"-")),T.default.createElement("div",null,T.default.createElement("span",null,(0,w.formatMessage)({id:"appOverview.updateTime"})),T.default.createElement("span",null,ae.update_time?(0,k.default)(ae.update_time).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"):"-"))))),De=B.default.getCurrTeamName(),Ae=B.default.getCurrRegionName(),Le={position:"relative",zIndex:1e3,padding:"0 16px",margin:"0 -16px",background:"#fff"},Oe=G.default.handleNewbie(j,"applicationInfo");return T.default.createElement(T.Fragment,null,T.default.createElement(o.default,{style:Oe&&1===Ee?Le:{}},be?xe:we),1===Ee&&this.handleNewbieGuiding({tit:(0,w.formatMessage)({id:"teamOther.Group.tit"}),showSvg:!1,showArrow:!0,send:!1,configName:"applicationInfo",desc:(0,w.formatMessage)({id:"teamOther.Group.desc"}),nextStep:2,conPosition:{top:"336px",left:"42%"}}),me&&T.default.createElement(C.default,{mode:ae&&ae.governance_mode,appID:this.getGroupId(),onCancel:this.onCancel,onOk:this.fetchAppDetail}),T.default.createElement(o.default,{className:z.default.rowArrow,style:2===Ee?Le:{}},T.default.createElement("div",{className:z.default.iconBox,onClick:()=>{this.heightOnchage(be)}},be?T.default.createElement("div",{className:z.default.showOrhide},T.default.createElement(N.DownOutlined,null)):T.default.createElement("div",{className:z.default.showOrhide},T.default.createElement(N.UpOutlined,null))),T.default.createElement(o.default,{style:{display:"flex",background:"#FFFFFF",height:"60px",alignItems:"center",borderBottom:"1px solid #e8e8e8",borderTopRightRadius:5,borderTopLeftRadius:5}},T.default.createElement(r.default,{span:5,style:{paddingleft:"12px"}},T.default.createElement("a",{onClick:()=>{this.changeType("shape"),this.setState({aggregation:!1,common:!0,compile:!1})},style:{marginLeft:"30px",color:"list"!==ue?"#1890ff":"rgba(0, 0, 0, 0.65)"}},(0,w.formatMessage)({id:"appOverview.topology"})),Z&&T.default.createElement("a",{onClick:()=>{this.changeType("list")},style:{marginLeft:"30px",color:"list"===ue?"#1890ff":"rgba(0, 0, 0, 0.65)"}},(0,w.formatMessage)({id:"appOverview.list"}))),T.default.createElement(r.default,{className:z.default.topoBtn,span:11,style:{paddingleft:"12px"}},"list"!==ue&&Q&&T.default.createElement(n.default.Group,null,ye?T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#4C73B0",color:"#F6F7FA",borderColor:"#4C73B0"},onClick:()=>{this.changeType("shape"),this.setState({aggregation:!1,common:!0,compile:!1})},disabled:!0},(0,w.formatMessage)({id:"appOverview.btn.ordinary"})):T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#fff",color:"#595959",borderColor:"#D9D9D9"},onClick:()=>{this.changeType("shape"),this.setState({aggregation:!1,common:!0,compile:!1})}},(0,w.formatMessage)({id:"appOverview.btn.ordinary"})),_e?T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#4C73B0",color:"#F6F7FA",borderColor:"#4C73B0"},onClick:()=>{this.changeType("aggregation"),this.setState({aggregation:!0,common:!1,compile:!1})},disabled:!0},(0,w.formatMessage)({id:"appOverview.btn.aggregation"})):T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#fff",color:"#595959",borderColor:"#D9D9D9"},onClick:()=>{this.changeType("aggregation"),this.setState({aggregation:!0,common:!1,compile:!1})}},(0,w.formatMessage)({id:"appOverview.btn.aggregation"})),Ce?T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#4C73B0",color:"#F6F7FA",borderColor:"#4C73B0"},onClick:()=>{this.changeType("shapes"),this.setState({aggregation:!1,common:!1,compile:!0})},disabled:!0},(0,w.formatMessage)({id:"appOverview.btn.arrange"})):T.default.createElement(n.default.Button,{style:{textAlign:"center",height:"32px",lineHeight:"32px",fontSize:"13px",padding:"0px 5px",background:"#fff",color:"#595959",borderColor:"#D9D9D9"},onClick:()=>{this.changeType("shapes"),this.setState({aggregation:!1,common:!1,compile:!0})}},(0,w.formatMessage)({id:"appOverview.btn.arrange"})))),T.default.createElement(r.default,{span:4,style:{textAlign:"right"}}),T.default.createElement(r.default,{span:4,style:{textAlign:"center"}},Q&&$&&T.default.createElement(V.default,{groupId:this.getGroupId(),refreshCurrent:()=>{this.loading()},onload:()=>{this.setState({type:"spin"},()=>{this.setState({type:"large"==this.state.size?"shape":"list"})})}}))),ie&&T.default.createElement(A.default,{copyFlag:!0,on:this.handleCloseRapidCopy,onCancel:this.handleCloseRapidCopy,title:(0,w.formatMessage)({id:"confirmModal.app.title.copy"})}),"list"===ue&&T.default.createElement(K.default,{componentPermissions:J,groupId:this.getGroupId()}),"shape"===ue&&T.default.createElement(H.default,{style:{height:Ne},group_id:this.getGroupId(),flagHeight:be,iframeHeight:Ne}),"aggregation"===ue&&T.default.createElement(F.default,{group_id:this.getGroupId(),flagHeight:be,iframeHeight:Ne}),"spin"===ue&&T.default.createElement(d.default,null),"shapes"===ue&&T.default.createElement(U.default,{changeType:e=>{this.changeType(e)},key:Ne,iframeHeight:Ne,group_id:this.getGroupId(),flagHeight:be})),2===Ee&&this.handleNewbieGuiding({tit:(0,w.formatMessage)({id:"teamOther.Group.app"}),btnText:(0,w.formatMessage)({id:"teamOther.Group.know"}),showSvg:!1,showArrow:!0,send:!0,configName:"applicationInfo",desc:(0,w.formatMessage)({id:"teamOther.Group.Topological"}),nextStep:3,conPosition:{bottom:"-16px",left:"45%"}}),Oe&&T.default.createElement("div",{id:"scroll_div",style:{marginTop:"180px"}}),pe&&T.default.createElement(D.default,{title:(0,w.formatMessage)({id:"confirmModal.app.title.delete"}),desc:(0,w.formatMessage)({id:"confirmModal.app.delete.desc"}),subDesc:(0,w.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),loading:q,onOk:this.handleDelete,onCancel:this.cancelDelete}),de&&T.default.createElement(_.default,{isAddGroup:!1,group_name:t.group_name,logo:t.logo,note:t.note,loading:R,k8s_app:t.k8s_app,title:(0,w.formatMessage)({id:"confirmModal.app.title.edit"}),onCancel:this.cancelEdit,onOk:this.handleEdit,isEditEnglishName:ae.can_edit}),ce&&T.default.createElement(y.default,{teamName:De,regionName:Ae,group_name:t.group_name,note:t.note,loading:R,principal:ae.username,onCancel:this.cancelEditAppDirector,onOk:this.handleEdit}),oe&&T.default.createElement(s.default,{title:(0,w.formatMessage)({id:"confirmModal.friendly_reminder.title"}),confirmLoading:I,visible:oe,onOk:this.handlePromptModalOpen,onCancel:this.handlePromptModalClose},T.default.createElement("p",null,(0,w.formatMessage)({id:"confirmModal.friendly_reminder.pages.desc"},{codeObj:Se[re]}))),T.default.createElement(O.default,null))}},f=g))||f);t.default=q},ri62:function(e,t,a){"use strict";var l=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=l(a("kLXV"));a("g9YV");var n=l(a("wCAj"));a("5NDa");var r=l(a("5rEg"));a("fOrg");var o=l(a("+KLJ"));a("+L6B");var d=l(a("2/Rp"));a("/xke");var c=l(a("TeRw"));a("OaEy");var p=l(a("2fM7"));a("y8nQ");var u,m,h,f,g=l(a("Vl3Y")),v=a("MuoO"),E=i(a("q1tI")),_=a("LLXN"),y=l(a("QDog")),C=g.default.Item,b=p.default.Option,N=(u=g.default.create(),m=(0,v.connect)(e=>{var t=e.loading;return{checkK8sLoading:t.effects["application/setCheckK8sServiceName"],governanceLoading:t.effects["application/setgovernancemode"]}}),u(h=m((f=class extends E.PureComponent{constructor(e){super(e),this.handleGovernanceModelList=(e=>{var t=this.props,a=t.dispatch,l=t.appID;a({type:"application/getGovernancemodeList",payload:{team_name:y.default.getCurrTeamName(),app_id:l},callback:e=>{this.setState({list:e.list})},handleError:e=>{}})}),this.setK8sServiceNames=(e=>{var t=this.props,a=t.dispatch,l=t.appID,i=t.onCancel,s=this.state.ServiceNameList,n=[];s.map(t=>{var a=t.service_id,l=t.port_alias,i=t.service_cname,s=t.k8s_service_name,r=t.port,o="".concat(a,"/").concat(l),d="".concat(a,"/").concat(s);o&&d&&n.push({service_cname:i,service_id:a,port:r,port_alias:e[o],k8s_service_name:e[d]})}),a({type:"application/setCheckK8sServiceName",payload:{tenantName:y.default.getCurrTeamName(),group_id:l,arr:n},callback:e=>{e&&200===e.status_code&&(this.handleNotification(),i())}})}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.form,a=this.state,l=a.step;a.isFlag,a.action,a.newFlag;t.validateFields((e,t)=>{e||(l?this.setK8sServiceNames(t):this.handleGovernancemode(t))})}),this.handleGovernancemode=(e=>{var t=this.props,a=t.dispatch,l=t.appID,i=t.onCancel,s=t.onOk,n=this.state.action;a({type:"application/setgovernancemode",payload:{tenantName:y.default.getCurrTeamName(),group_id:l,governance_mode:e.governance_mode,action:n},callback:t=>{t.bean.governance_cr&&"create"==n?this.handleCreateKubernetes(t.bean.governance_cr):t.bean.governance_cr&&"update"==n?this.handleUpdateKubernetes(t.bean.governance_cr):this.handleDeleteKubernetes(),s(),"BUILD_IN_SERVICE_MESH"!==e.governance_mode?this.fetchServiceNameList():(this.handleNotification(),i())}})}),this.handleNotification=(()=>{c.default.success({message:(0,_.formatMessage)({id:"notification.hint.component.change"}),duration:"3"})}),this.fetchServiceNameList=(()=>{var e=this.props,t=e.dispatch,a=e.appID,l=e.onCancel;t({type:"application/fetchServiceNameList",payload:{tenantName:y.default.getCurrTeamName(),group_id:a},callback:e=>{e&&e.bean&&(e.list&&e.list.length>0?this.setState({step:!0,ServiceNameList:e.list}):(this.handleNotification(),l()))}})}),this.checkK8sServiceName=(e=>{var t=this.props,a=t.dispatch,l=t.appID;a({type:"application/checkK8sServiceName",payload:{tenantName:y.default.getCurrTeamName(),group_id:l,service_alias:e.service_alias,k8s_service_name:e.k8s_service_name},callback:e=>{e&&e.bean&&!e.bean.is_valid&&this.setK8sServiceNames()}})}),this.checkServiceName=((e,t,a)=>{var l=this.props,i=l.dispatch,s=l.appID,n=this.stata.ServiceNameList;try{i({type:"application/checkK8sServiceName",payload:{tenantName:y.default.getCurrTeamName(),group_id:s,service_alias:n[0].service_alias,k8s_service_name:n[0].k8s_service_name},callback:e=>{if(!e||!e.bean||e.bean.is_valid)throw new Error((0,_.formatMessage)({id:"placeholder.govern.is_valid"}));a()}})}catch(e){return void a(e)}a()}),this.rowKey=((e,t)=>t),this.handleOnCancel=(()=>{var e=this.props.onCancel;this.state.step&&this.handleNotification(),e()}),this.handleChange=(e=>{var t=this.props;t.dispatch,t.appID,t.mode;this.setState({governName:e}),"BUILD_IN_SERVICE_MESH"==e||"KUBERNETES_NATIVE_SERVICE"==e?this.setState({newFlag:!0},()=>{var e=this.state,t=e.isFlag,a=e.newFlag;t?t==a?this.setState({action:""},()=>{this.getActionValue()}):this.setState({action:"create"},()=>{this.getActionValue()}):t==a?this.setState({action:"update"},()=>{this.getActionValue()}):this.setState({action:"delete"},()=>{this.getActionValue()})}):this.setState({newFlag:!1},()=>{var e=this.state,t=e.isFlag,a=e.newFlag;t?t==a?this.setState({action:"update"},()=>{this.getActionValue()}):this.setState({action:"create"},()=>{this.getActionValue()}):t==a?this.setState({action:"update"},()=>{this.getActionValue()}):this.setState({action:"delete"},()=>{this.getActionValue()})})}),this.getActionValue=(()=>{var e=this.state.action;return e}),this.handleCreateKubernetes=(e=>{var t=this.props,a=t.dispatch,l=t.appID;a({type:"application/createKubernetesVal",payload:{team_name:y.default.getCurrTeamName(),app_id:l,governance_cr:e},callback:e=>{},handleError:e=>{}})}),this.handleUpdateKubernetes=(e=>{var t=this.props,a=t.dispatch,l=t.appID;a({type:"application/updateKubernetesVal",payload:{team_name:y.default.getCurrTeamName(),app_id:l,governance_cr:e},callback:e=>{},handleError:e=>{}})}),this.handleDeleteKubernetes=(()=>{var e=this.props,t=e.dispatch,a=e.appID;t({type:"application/deleteKubernetesVal",payload:{team_name:y.default.getCurrTeamName(),app_id:a},callback:e=>{},handleError:e=>{}})}),this.handleFindDesc=(e=>{var t=this.state.list;return E.default.createElement("div",{style:{marginTop:"10px"}},t.map(t=>{return t.name==e?t.description:""}))}),this.blurInput=((e,t)=>{var a=this.state.ServiceNameList,l=[];a.map((a,i)=>{a.service_id==t?(a.k8s_service_name=e.target.value,l.push(a)):l.push(a)}),this.setState({ServiceNameList:l})}),this.state={step:!1,ServiceNameList:[],btnConfig:!1,list:[],governName:this.props.mode||"",isFlag:"KUBERNETES_NATIVE_SERVICE"==this.props.mode||"BUILD_IN_SERVICE_MESH"==this.props.mode,action:"",newFlag:!1}}componentDidMount(){this.handleGovernanceModelList()}render(){var e=this.props,t=e.loading,a=void 0!==t&&t,l=(e.onCancel,e.form),i=e.checkK8sLoading,c=e.governanceLoading,u=e.mode,m=this.state,h=m.step,f=m.ServiceNameList,v=m.btnConfig,N=m.list,M=(m.action,m.governName),S=l.getFieldDecorator;l.getFieldValue;return E.default.createElement(s.default,{title:(0,_.formatMessage)({id:"confirmModal.app.govern.title"}),visible:!0,confirmLoading:a||i||c,onOk:this.handleSubmit,onCancel:this.handleOnCancel,width:800,footer:[E.default.createElement(d.default,{onClick:this.handleOnCancel},(0,_.formatMessage)({id:"popover.cancel"})),E.default.createElement(d.default,{type:"primary",disabled:v,loading:a||i||c,onClick:this.handleSubmit},(0,_.formatMessage)({id:"popover.confirm"}))]},E.default.createElement(o.default,{style:{marginBottom:"20px"},message:(0,_.formatMessage)({id:"confirmModal.app.govern.alert.msg"}),type:"info",showIcon:!0}),E.default.createElement(g.default,{onSubmit:this.handleSubmit},h?E.default.createElement(n.default,{size:"middle",rowKey:this.rowKey,pagination:!1,dataSource:f||[],columns:[{title:(0,_.formatMessage)({id:"confirmModal.app.govern.label.name_port"}),dataIndex:"service_alias",width:200,render:(e,t)=>E.default.createElement("div",null,t.service_cname,"/",t.port)},{title:(0,_.formatMessage)({id:"confirmModal.app.govern.label.alias"}),dataIndex:"port_alias",width:200,render:(e,t)=>E.default.createElement(C,{style:{marginBottom:0}},S("".concat(t.service_id,"/").concat(t.port_alias),{initialValue:e||"",rules:[{required:!0,message:(0,_.formatMessage)({id:"placeholder.copy.not_null"})}]})(E.default.createElement(r.default,{size:"small"})))},{title:(0,_.formatMessage)({id:"confirmModal.app.govern.label.DNS"}),dataIndex:"k8s_service_name",width:200,render:(e,t)=>E.default.createElement(C,{style:{marginBottom:0}},S("".concat(t.service_id,"/").concat(t.k8s_service_name),{initialValue:e||"",rules:[{required:!0,message:(0,_.formatMessage)({id:"placeholder.copy.not_null"})},{max:63,message:(0,_.formatMessage)({id:"placeholder.max63"})},{pattern:/^[a-z]([-a-z0-9]*[a-z0-9])?$/,message:(0,_.formatMessage)({id:"placeholder.k8s_service_name.msg"})}]})(E.default.createElement(r.default,{size:"small",onBlur:e=>{this.blurInput(e,t.service_id)}})))}]}):E.default.createElement("div",null,E.default.createElement(C,{labelCol:{xs:{span:14},sm:{span:8}},wrapperCol:{xs:{span:14,offset:0},sm:{span:8}},label:(0,_.formatMessage)({id:"confirmModal.app.govern.label.change"})},S("governance_mode",{initialValue:u||"KUBERNETES_NATIVE_SERVICE",rules:[{required:!0,message:(0,_.formatMessage)({id:"placeholder.copy.not_null"})}]})(E.default.createElement(p.default,{style:{width:"357px"},onChange:this.handleChange,getPopupContainer:e=>e.parentNode},N.map(e=>{return E.default.createElement(b,{key:e.name,value:e.name},"BUILD_IN_SERVICE_MESH"===e.name||"KUBERNETES_NATIVE_SERVICE"===e.name?y.default.fetchGovernanceMode(e.name):e.name)})))),E.default.createElement("div",{style:{width:"468px",margin:"0 auto",border:"1px solid #ccc",padding:"10px",borderRadius:"8px"}},E.default.createElement("label",{htmlFor:"governance_mode",className:"ant-form-item-required",title:(0,_.formatMessage)({id:"confirmModal.app.govern.label.mode"})},(0,_.formatMessage)({id:"confirmModal.app.govern.label.mode"})),this.handleFindDesc(M)))))}},h=f))||h)||h);t.default=N}}]);