(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{"+zy9":function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5Dmo");var l=s(a("3S7+"));a("7Kak");var i=s(a("9yH6"));a("+L6B");var r=s(a("2/Rp"));a("/xke");var d,o,u,c=s(a("TeRw")),m=a("MuoO"),p=a("7DNP"),h=n(a("q1tI")),f=a("LLXN"),v=s(a("exCG")),g=s(a("q76B")),_=a("xpXo"),M=s(a("QDog")),y=s(a("hMqj")),b=(d=(0,m.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{withRef:!0}),d((u=class extends h.PureComponent{constructor(e){super(e),this.getMultipleModulesInfo=(()=>{this.props.dispatch({type:"appControl/getMultipleModulesInfo",payload:{team_name:M.default.getCurrTeamName(),check_uuid:this.getCheck_uuid()},callback:e=>{e&&200===e.status_code&&this.setState({data:e.list})}})}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return y.default.querySpecifiedPermissionsInfo(t,e)}),this.handleBuild=(()=>{this.setState({buildState:!0});var e=this.state,t=e.JavaMavenData,a=e.is_deploy;if(t.length>0){var s=this.fetchParameter(),n=s.team_name,l=s.app_alias;this.props.dispatch({type:"appControl/createService",payload:{team_name:n,app_alias:l,service_infos:t},callback:e=>{if(e&&200===e.status_code){var t=e.bean&&e.bean.group_id,s=e.bean&&e.bean.service_ids;a?this.BuildShape(t,s):this.fetchGroups(t)}}})}else this.setState({buildState:!1}),c.default.warning({message:(0,f.formatMessage)({id:"notification.warn.need_build_module"})})}),this.BuildShape=((e,t)=>{(0,_.batchOperation)({action:"deploy",team_name:M.default.getCurrTeamName(),serviceIds:t&&t.length>0&&t.join(",")}).then(()=>{this.fetchGroups(e)})}),this.fetchGroups=(e=>{var t=this.fetchParameter(),a=t.team_name,s=t.region_name,n=this.props.dispatch;n({type:"global/fetchGroups",payload:{team_name:a,region_name:s},callback:()=>{c.default.success({message:(0,f.formatMessage)({id:"notification.success.success_create_components"}),duration:"3"}),this.setState({buildState:!1}),this.handleJump("apps/".concat(e))}})}),this.handleDelete=(()=>{var e=this.fetchParameter(),t=e.team_name,a=e.app_alias,s=this.props.dispatch;this.handleDeleteLoading(!0),s({type:"appControl/deleteApp",payload:{team_name:t,app_alias:a,is_force:!0},callback:()=>{this.handleDeleteLoading(!1),this.handleJump("index")}})}),this.handleDeleteLoading=(e=>{this.setState({deleteLoading:e})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.fetchParameter=(()=>{return{team_name:M.default.getCurrTeamName(),region_name:M.default.getCurrRegionName(),app_alias:this.getAppAlias()}}),this.handleJump=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),s=a.team_name,n=a.region_name;t(p.routerRedux.replace("/team/".concat(s,"/region/").concat(n,"/").concat(e)))}),this.renderSuccessOnChange=(()=>{this.setState({is_deploy:!this.state.is_deploy})}),this.state={appPermissions:this.handlePermissions("queryAppInfo"),data:null,JavaMavenData:[],is_deploy:!0,deleteLoading:!1,buildState:!1}}componentDidMount(){this.getMultipleModulesInfo()}componentWillUnmount(){this.props.dispatch({type:"appControl/clearDetail"})}getCheck_uuid(){return this.props.match.params.check_uuid}getAppAlias(){return this.props.match.params.appAlias}render(){var e=this.state,t=e.data,a=e.is_deploy,s=e.buildState,n=e.showDelete,d=e.deleteLoading,o=e.appPermissions.isDelete,u=t;return u&&u.length>0&&u.map((e,t)=>{u[t].index=t}),h.default.createElement("div",null,h.default.createElement("h2",{style:{textAlign:"center"}},(0,f.formatMessage)({id:"JavaMaven.title"})),h.default.createElement("div",{style:{overflow:"hidden"}},t&&t.length>0&&h.default.createElement(v.default,{data:u,onSubmit:e=>{this.setState({JavaMavenData:e})}}),h.default.createElement("div",{style:{background:"#fff",padding:"20px",textAlign:"right",position:"fixed",bottom:0,left:0,right:0,zIndex:2,borderTop:"1px solid #e8e8e8"}},h.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"}},h.default.createElement(r.default,{style:{marginRight:8},onClick:this.handleBuild,loading:s,type:"primary"},(0,f.formatMessage)({id:"button.confirm_create"})),h.default.createElement("div",null,h.default.createElement(l.default,{placement:"topLeft",title:(0,f.formatMessage)({id:"JavaMaven.Tooltip"})},h.default.createElement(i.default,{size:"small",onClick:this.renderSuccessOnChange,checked:a},(0,f.formatMessage)({id:"button.build_start"})))),o&&h.default.createElement(r.default,{onClick:this.showDelete,type:"default"},(0,f.formatMessage)({id:"button.abandon_create"})))),n&&h.default.createElement(g.default,{onOk:this.handleDelete,loading:d,title:(0,f.formatMessage)({id:"confirmModal.abandon_create.create_check.title"}),subDesc:(0,f.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),desc:(0,f.formatMessage)({id:"confirmModal.delete.create_check.desc"}),onCancel:()=>{this.setState({showDelete:!1})}})))}},o=u))||o);t.default=b},FRTm:function(e,t,a){e.exports={typeBtnWrap:"typeBtnWrap___1asGj",typeBtn:"typeBtn___1uRh_",active:"active___1sarO",content:"content___C0tD4",ant_radio_disabled:"ant_radio_disabled___2AquS"}},exCG:function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fOrg");var l=s(a("+KLJ"));a("g9YV");var i=s(a("wCAj")),r=s(a("jehZ"));a("+L6B");var d=s(a("2/Rp"));a("/xke");var o=s(a("TeRw"));a("y8nQ");var u=s(a("Vl3Y"));a("2qtc");var c=s(a("kLXV"));a("5NDa");var m=s(a("5rEg"));a("Znn+");var p=s(a("ZTPi"));a("7Kak");var h,f,v,g,_,M,y=s(a("9yH6")),b=n(a("q1tI")),E=a("MuoO"),C=a("LLXN"),S=(a("7DNP"),s(a("QDog")),s(a("n9hB")),s(a("8+Sn"))),w=s(a("FRTm")),x=(y.default.Button,y.default.Group,p.default.TabPane,m.default.TextArea),D=(c.default.confirm,h=(0,E.connect)(e=>{var t=e.user;e.appControl,e.teamControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),f=u.default.create(),h(v=f((g=class extends b.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onSubmit&&this.props.onSubmit(t)})}),this.handleEdit=(e=>{var t="",a="";e&&e.envs&&e.envs.length>0&&e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(t=e.value),"BUILD_PROCFILE"==e.name&&(a=e.value)}),this.setState({isEdit:!0,editData:e,buildValue:t,startValue:a})}),this.handleOk=(()=>{var e=this.state,t=e.memoryList,a=e.editData,s=this.props.form,n=t;s.validateFields((e,t)=>{e||(n.map(e=>{e.id==a.id&&(e.cname=t.cname,e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(e.value=t.BUILD_MAVEN_CUSTOM_OPTS),"BUILD_PROCFILE"==e.name&&(e.value=t.PROCFILE)}))}),this.setState({memoryList:n},()=>{o.default.destroy(),o.default.success({message:(0,C.formatMessage)({id:"notification.success.edit"})}),this.handleCancel()}))})}),this.handleCancel=(()=>{this.setState({isEdit:!1,isIndex:!1})}),this.state={isShow:[!0,!0],memoryList:this.props.data,isEdit:!1,isIndex:!1,editData:!1,buildValue:"",startValue:"",activeselectedRows:[],activeselectedRowKeys:"",language:"zh-CN"===S.default.get("language")}}render(){var e=[{title:(0,C.formatMessage)({id:"JavaMaven.name"}),dataIndex:"name",rowKey:"name",width:"15%"},{title:(0,C.formatMessage)({id:"JavaMaven.cname"}),dataIndex:"cname",rowKey:"cname",width:"15%"},{title:(0,C.formatMessage)({id:"JavaMaven.packaging"}),dataIndex:"packaging",rowKey:"packaging",width:"8%"},{title:(0,C.formatMessage)({id:"JavaMaven.index"}),dataIndex:"index",rowKey:"index",width:"10%",render:(e,t)=>{return b.default.createElement("span",{key:e},t.ports&&t.ports.length>0?t.ports[0].container_port:e+5e3)}},{title:(0,C.formatMessage)({id:"JavaMaven.envs"}),dataIndex:"envs",rowKey:"envs",width:"45%",render:(e,t)=>{var a="",s="",n="";return e&&e.length>0&&e.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(a=e.value),"BUILD_MAVEN_CUSTOM_GOALS"==e.name&&(s=e.value),"BUILD_PROCFILE"==e.name&&(n=e.value)}),b.default.createElement("div",{key:t},b.default.createElement("div",{style:{display:"flex"}},b.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.OPTS"}),":"),b.default.createElement("div",{style:{width:"70%"}},a)),b.default.createElement("div",{style:{display:"flex"}},b.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.GOALS"}),":"),b.default.createElement("div",{style:{width:"70%"}},s)),b.default.createElement("div",{style:{display:"flex"}},b.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.startValue"}),":"),b.default.createElement("div",{style:{width:"70%"}},n)))}},{title:(0,C.formatMessage)({id:"JavaMaven.id"}),dataIndex:"id",rowKey:"id",width:"7%",render:(e,t)=>{return b.default.createElement(d.default,{onClick:()=>{this.handleEdit(t)}},(0,C.formatMessage)({id:"teamOther.manage.edit"}))}}],t={onChange:(e,t)=>{this.props.onSubmit(t)},getCheckboxProps:e=>({disabled:e.operation,operation:e.operation})},a=this.props.form,s=a.getFieldDecorator,n=(a.getFieldValue,{labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:18},sm:{span:18}}}),l={labelCol:{xs:{span:10},sm:{span:10}},wrapperCol:{xs:{span:14},sm:{span:14}}},o=this.state,p=o.memoryList,h=o.isEdit,f=o.editData,v=o.buildValue,g=o.startValue,_=o.language,M=_?n:l;return b.default.createElement("div",null,h&&b.default.createElement(c.default,{title:(0,C.formatMessage)({id:"teamOther.manage.edit"}),visible:h,onOk:this.handleOk,onCancel:this.handleCancel},b.default.createElement(u.default.Item,(0,r.default)({},M,{label:(0,C.formatMessage)({id:"JavaMaven.cname"})}),s("cname",{initialValue:f&&f.cname,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.cname_input"})}]})(b.default.createElement(m.default,{placeholder:""}))),b.default.createElement(u.default.Item,(0,r.default)({},M,{label:(0,C.formatMessage)({id:"JavaMaven.bulid"})}),s("BUILD_MAVEN_CUSTOM_OPTS",{initialValue:v&&v,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.bulid_input"})}]})(b.default.createElement(x,{placeholder:""}))),b.default.createElement(u.default.Item,(0,r.default)({},M,{label:(0,C.formatMessage)({id:"JavaMaven.start"})}),s("PROCFILE",{initialValue:g&&g,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.start_input"})}]})(b.default.createElement(x,{placeholder:""})))),b.default.createElement(i.default,{rowSelection:t,dataSource:p,columns:e,pagination:!1,style:{background:"#fff",marginTop:"20px"}}))}},v=g))||v)||v),I=(_=(0,E.connect)(e=>{var t=e.user;e.appControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),_(M=class extends b.PureComponent{constructor(e){super(e),this.state={}}render(){var e=this.props.data;return b.default.createElement("div",null,b.default.createElement("div",{style:{overflow:"hidden"}},b.default.createElement("div",{className:w.default.content,style:{overflow:"hidden",marginBottom:90}},b.default.createElement(l.default,{message:(0,C.formatMessage)({id:"JavaMaven.Alert"}),type:"success"}),b.default.createElement(D,{data:e,onSubmit:this.props.onSubmit}))))}})||M);t.default=I}}]);