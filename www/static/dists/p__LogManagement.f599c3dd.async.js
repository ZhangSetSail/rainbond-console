(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[66],{"+ygn":function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var l=s(a("kLXV"));a("Pwec");var o,r,i,d=s(a("CtXQ")),c=s(a("PWDA")),u=a("MuoO"),g=n(a("q1tI")),h=(a("xpXo"),s(a("QDog")),s(a("1Pi2"))),f=a("LLXN"),m=(o=(0,u.connect)(null,null,null,{withRef:!0}),o((i=class extends g.PureComponent{constructor(e){super(e),this.fetchClusterLogInfoSingle=(()=>{var e=this.props,t=e.dispatch,a=e.region,s=e.RbdName;t({type:"region/fetchClusterLogInfoSingle",payload:{region_name:a,rbd_name:s,lines:2e3},callback:e=>{e&&this.setState({loading:!1,list:e.bean||[]})}})}),this.state={list:[],loading:!0,showHighlighted:""}}componentDidMount(){this.fetchClusterLogInfoSingle()}render(){var e=this.state,t=e.loading,a=e.list,s=e.showHighlighted;return g.default.createElement(l.default,{title:g.default.createElement(f.FormattedMessage,{id:"componentOverview.body.tab.log.History1000Log.title"}),visible:!0,width:1e3,bodyStyle:{background:"#222222",color:"#fff"},className:h.default.logModal,onCancel:this.props.onCancel,footer:null},t?g.default.createElement("div",{style:{textAlign:"center"}},g.default.createElement(d.default,{type:"loading",style:{marginTop:20,marginBottom:20}})):"",t?"":g.default.createElement("div",{style:{padding:"20px 0",maxHeight:500,overflowY:"auto",background:"#212121"}},a.length>0?g.default.createElement("div",{className:h.default.History1000Log},a.map((e,t)=>{return g.default.createElement("div",{key:t},g.default.createElement("span",{style:{color:s===e.substring(0,e.indexOf(":"))?"#FFFF91":"#666666"}},g.default.createElement("b",null),g.default.createElement("span",null,""===e?"":"".concat(t+1))),g.default.createElement("span",{ref:"texts",style:{color:s==e.substring(0,e.indexOf(":"))?"#FFFF91":"#FFF"}},g.default.createElement(c.default,null,e.substring(e.indexOf(":")+1,e.length))),1===a.length?g.default.createElement("span",{style:{color:s===e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:s==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},g.default.createElement(c.default,null,e.substring(0,e.indexOf(":")))," "):a.length>1&&t>=1&&e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":g.default.createElement("span",{style:{color:s==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==t&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:s==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},g.default.createElement(c.default,null,e.substring(0,e.indexOf(":")))," "))})):g.default.createElement("p",{style:{textAlign:"center",marginBottom:0,color:"#999"}},g.default.createElement(f.FormattedMessage,{id:"componentOverview.body.tab.log.History1000Log.null"}))))}},r=i))||r);t.default=m},"1Pi2":function(e,t,a){e.exports={logStyle:"logStyle___25wV8",podCascader:"podCascader___2o1Lt",logModal:"logModal___3dS4J",History1000Log:"History1000Log___2Ptr_"}},"6Qhi":function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Znn+");var l,o,r,i=s(a("ZTPi")),d=(s(a("DPVJ")),a("MuoO")),c=(a("7DNP"),s(a("i8i4")),n(a("q1tI"))),u=a("LLXN"),g=s(a("XZXw")),h=s(a("yUTz")),f=(s(a("+iC2")),s(a("J5jb")),s(a("QDog"))),m=s(a("2lxJ")),p=s(a("pKpl")),b=s(a("dnMv")),y=i.default.TabPane,v=(l=(0,d.connect)(e=>{var t=e.user,a=e.list,s=e.loading,n=e.global,l=e.index;return{user:t.currentUser,list:a,loading:s.models.list,rainbondInfo:n.rainbondInfo,enterprise:n.enterprise,isRegist:n.isRegist,oauthLongin:s.effects["global/creatOauth"],certificateLongin:s.effects["global/putCertificateType"],overviewInfo:l.overviewInfo}}),l((r=class extends c.PureComponent{constructor(e){super(e),this.onChange=(e=>{this.setState({activeKey:e})}),this.callback=(e=>{}),this.handleLoadEnterpriseClusters=(()=>{var e=this.props.dispatch,t=f.default.getCurrEnterpriseId();e({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:t},callback:e=>{200==e.status_code&&this.setState({ClustersList:e.list})}})}),this.state={activeKey:"consoleLog",ClustersList:[]},this.socket=null}componentDidMount(){this.handleLoadEnterpriseClusters()}render(){var e=this.state,t=(e.adminer,e.activeKey),a=e.ClustersList,s=f.default.getCurrEnterpriseId();return c.default.createElement(g.default,{title:(0,u.formatMessage)({id:"LogEnterprise.title"}),content:(0,u.formatMessage)({id:"LogEnterprise.desc"}),titleSvg:m.default.getSvg("logSvg",18),isContent:!0},c.default.createElement(i.default,{onChange:this.onChange,activeKey:t,destroyInactiveTabPane:!0,className:b.default.setTabs,type:"card"},c.default.createElement(y,{tab:(0,u.formatMessage)({id:"LogEnterprise.console"}),key:"consoleLog"},c.default.createElement(p.default,{type:!0})),a.map((e,t)=>{var a=e.region_alias,n=e.region_name,l=(e.url,e.region_id);return c.default.createElement(y,{tab:"".concat(a," ").concat((0,u.formatMessage)({id:"LogEnterprise.title"})),key:t,className:b.default.logInfoStyle},c.default.createElement(h.default,{region:n,regionId:l,regionAlias:a,eid:s}))})))}},o=r))||o);t.default=v},dnMv:function(e,t,a){e.exports={logInfoStyle:"logInfoStyle___3UgtI",setTabs:"setTabs___1t27B",tabsStyle:"tabsStyle___KltxB",setFrom:"setFrom___3xm6c"}},hDHe:function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var l=s(a("kLXV"));a("Pwec");var o=s(a("CtXQ"));a("+L6B");var r,i,d=s(a("2/Rp")),c=n(a("q1tI")),u=a("MuoO"),g=(a("xpXo"),s(a("QDog")),s(a("mJtp")),a("LLXN")),h=(s(a("nyIC")),r=(0,u.connect)(null,null,null,{withRef:!0}),r(i=class extends c.PureComponent{constructor(e){super(e),this.state={list:[],loading:!0}}componentDidMount(){this.loadData()}loadData(){var e=this.props,t=e.dispatch,a=e.RbdName,s=e.region;t({type:"region/fetchHistoryLogs",payload:{rbd_name:a,region_name:s},callback:e=>{e&&e.bean&&e.bean.length>0&&this.setState({list:e.bean,loading:!1})}})}render(){var e=this.state,t=e.loading,a=e.list;return c.default.createElement(l.default,{title:c.default.createElement(g.FormattedMessage,{id:"componentOverview.body.tab.log.HistoryLog.title"}),visible:!0,width:700,onCancel:this.props.onCancel,footer:[c.default.createElement(d.default,{onClick:this.props.onCancel},c.default.createElement(g.FormattedMessage,{id:"componentOverview.body.tab.log.HistoryLog.close"}))]},t?c.default.createElement("div",{style:{textAlign:"center"}},c.default.createElement(o.default,{type:"loading",style:{marginTop:100,marginBottom:100}})):"",t?"":c.default.createElement("div",{style:{textAlign:"left"}},a.length>0?c.default.createElement("div",null,a.map(e=>{return c.default.createElement("p",{key:e.file_name},c.default.createElement("a",{rel:"noopener noreferrer",href:e.file_url},e.file_name))})):c.default.createElement("p",{style:{textAlign:"center"}},c.default.createElement(g.FormattedMessage,{id:"componentOverview.body.tab.log.HistoryLog.null"}))))}})||i);t.default=h},pKpl:function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l=s(a("bx4M"));a("y8nQ");var o=s(a("Vl3Y"));a("5NDa");var r=s(a("5rEg"));a("+L6B");var i=s(a("2/Rp"));a("OaEy");var d,c,u,g=s(a("2fM7")),h=a("MuoO"),f=n(a("q1tI")),m=s(a("PWDA")),p=(s(a("cUW5")),a("xpXo"),s(a("lpA0"))),b=s(a("DPVJ")),y=(s(a("QDog")),s(a("rIpq")),s(a("hMqj")),s(a("zcww")),s(a("+iC2")),s(a("mJtp"))),v=s(a("hDHe")),E=s(a("+ygn")),L=s(a("1Pi2")),w=a("LLXN"),C=(s(a("Y5yc")),g.default.Option),x=(d=(0,h.connect)(e=>{var t=e.user;return{currUser:t.currentUser}},null,null,{withRef:!0}),d((u=class extends f.PureComponent{constructor(e){super(e),this.fetchConsoleLogs=(()=>{var e=this.props,t=e.dispatch;e.region;t({type:"region/fetchConsoleLogs",callback:e=>{e&&(this.setState({logs:e.bean||[]},()=>{this.hanleConsoTimer()}),this.watchLog())}})}),this.onFinish=(e=>{var t=this.props,a=t.type,s=t.ss;this.setState({filter:e},()=>{var t=this.state,n=t.logs,l=t.pod_name;""===e?a?(this.fetchConsoleLogs(),clearInterval(s)):l?this.fetchContainerLog():this.fetchClusterLogInfoSingle():this.setLogs(n)})}),this.setLogs=(e=>{var t=this.state,a=t.filter,s=t.pod_name,n=e;n=e.filter(e=>{return""==a||-1!=e.indexOf(a)}),n=n.map(e=>{if(-1!=e.indexOf(a)){var t=e.replace(a,"\x1b[33m".concat(a,"\x1b[0m"));return t}return e}),n.length>5e3&&(n=n.slice(e.length-5e3,e.length));var l=s?{containerLog:n}:{logs:n};this.setState(l)}),this.watchLog=(()=>{this.socket&&this.socket.setOnLogMessage(e=>{if(e&&e.length>0){var t=this.state.logs||[],a=t.concat(e);this.setLogs(a)}},e=>{if(this.state.started){var t=this.state.logs||[];t=t.concat(e),this.refs.box&&(this.refs.box.scrollTop=this.refs.box.scrollHeight),this.setLogs(t)}})}),this.fetchClusterLogInfoSingle=(()=>{var e=this.props,t=e.dispatch,a=e.region,s=e.RbdName;t({type:"region/fetchClusterLogInfoSingle",payload:{region_name:a,rbd_name:s,lines:100},callback:e=>{e&&(this.refs.box&&(this.refs.box.scrollTop=this.refs.box.scrollHeight),this.setState({logs:e.bean||[]}),this.watchLog())}})}),this.hanleTimer=(()=>{var e=this.state.refreshValue;if(this.closeTimer(),!e)return null;var t=setTimeout(()=>{this.fetchContainerLog()},1e3*e);this.setState({time:t})}),this.hanleConsoTimer=(()=>{this.closeTimer();var e=setTimeout(()=>{this.fetchConsoleLogs()},2e3);this.setState({time:e})}),this.handleTimers=((e,t,a)=>{var s=this.state.componentTimer;if(!s)return null;this[e]=setTimeout(()=>{t()},a)}),this.closeTimer=(()=>{var e=this.state.time;e&&clearInterval(e)}),this.fetchContainerLog=(()=>{var e=this.state,t=e.pod_name,a=(e.container_name,this.props),s=a.region,n=a.dispatch;n({type:"region/fetchNodeInfo",payload:{region_name:s,pod_name:t},callback:e=>{if(e&&e.status_code&&200===e.status_code&&e.response_data){var t=e.response_data.split("\n");this.setState({containerLog:t||[]},()=>{this.hanleTimer()})}}})}),this.handleStop=(()=>{this.setState({started:!1}),this.socket&&this.socket.closeLogMessage()}),this.handleStart=(()=>{this.setState({started:!0}),this.watchLog()}),this.showDownHistoryLog=(()=>{this.setState({showHistoryLog:!0})}),this.hideDownHistoryLog=(()=>{this.setState({showHistoryLog:!1})}),this.showDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!0})}),this.hideDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!1})}),this.onChangeCascader=(e=>{e&&e.length>1?this.setState({pod_name:e,container_name:e[1].slice(3)},()=>{this.fetchContainerLog()}):this.setState({pod_name:"",container_name:"",containerLog:[]},()=>{this.closeTimer(),this.fetchClusterLogInfoSingle()})}),this.handleChange=(e=>{this.setState({refreshValue:e}),e||this.closeTimer()}),this.downloadLogs=(()=>{(0,y.default)("/console/enterprise/download/goodrain_log","goodrain.log")}),this.state={containerLog:[],logs:[],instances:[],started:!0,showHistoryLog:!1,showHistory1000Log:!1,showHighlighted:"",filter:"",pod_name:"",container_name:"",refreshValue:5},this.socket=null}componentWillMount(){this.createSocket()}componentDidMount(){var e=this.props.type;e?this.fetchConsoleLogs():this.loadLog()}componentDidUpdate(e,t){this.refs.box&&t.logs.length!==this.state.logs.length&&""===this.state.showHighlighted&&(this.refs.box.scrollTop=this.refs.box.scrollHeight)}componentWillUnmount(){this.socket&&(this.socket.closeLogMessage(),this.socket.destroy(),this.socket=null)}createSocket(){var e=this.props,t=e.RbdName,a=e.region,s=e.tcpUrl,n="".concat(s,"/services/").concat(a,"/pubsub");s&&(this.socket=new b.default({url:n,serviceId:t,isAutoConnect:!0,destroyed:!1,time:""}))}loadLog(){var e=this.state.logs;0==e.length?this.fetchClusterLogInfoSingle():this.watchLog()}canView(){return p.default.canManageAppLog(this.props.appDetail)}render(){var e=this.state,t=e.logs,a=e.pod_name,s=e.containerLog,n=e.showHighlighted,d=e.started,c=e.refreshValue,u=e.showHistoryLog,h=e.showHistory1000Log,p=(e.time,this.props),b=p.instances,y=p.type,x=p.RbdName,_=p.region;return f.default.createElement(l.default,{style:{border:0,borderBottomLeftRadius:5,borderBottomRightRadius:5},title:f.default.createElement(f.Fragment,null,y?f.default.createElement(f.default.Fragment,null,f.default.createElement(i.default,{onClick:this.downloadLogs},(0,w.formatMessage)({id:"LogEnterprise.download"}))):d?f.default.createElement(i.default,{onClick:this.handleStop},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.push"})):f.default.createElement(i.default,{onClick:this.handleStart},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.startPushing"}))),extra:f.default.createElement(f.Fragment,null,!y&&f.default.createElement(f.default.Fragment,null,f.default.createElement("a",{onClick:this.showDownHistoryLog,style:{marginRight:10}},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.install"})),f.default.createElement("a",{onClick:this.showDownHistory1000Log},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.lately"})))),bodyStyle:{borderBottomLeftRadius:5,borderBottomRightRadius:5}},f.default.createElement(o.default,{layout:"inline",name:"logFilter",style:{marginBottom:"16px",display:y?"flex":"block",justifyContent:"space-between"}},f.default.createElement(o.default.Item,{name:"filter",label:f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.text"}),style:{marginRight:"10px"}},f.default.createElement(r.default.Search,{style:{width:"300px"},placeholder:(0,w.formatMessage)({id:"componentOverview.body.tab.log.filtertext"}),onSearch:this.onFinish})),!y&&f.default.createElement(o.default.Item,{name:"container",label:(0,w.formatMessage)({id:"LogEnterprise.node"}),style:{marginRight:"10px"},className:L.default.podCascader},f.default.createElement(g.default,{placeholder:(0,w.formatMessage)({id:"LogEnterprise.find"}),style:{width:240},onChange:this.onChangeCascader},b&&b.length>0&&b.map(e=>{var t=e.node_name,a=e.pod_name;return f.default.createElement(C,{value:a},t)}),f.default.createElement(C,{value:""},(0,w.formatMessage)({id:"LogEnterprise.all"})))),a&&f.default.createElement(o.default.Item,{name:"refresh",label:f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.refresh"}),style:{marginRight:"0"}},f.default.createElement(g.default,{value:c,onChange:this.handleChange,style:{width:130}},f.default.createElement(C,{value:5},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.five"})),f.default.createElement(C,{value:10},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.ten"})),f.default.createElement(C,{value:30},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.thirty"})),f.default.createElement(C,{value:0},f.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.log.close"}))))),f.default.createElement("div",{className:L.default.logStyle,ref:"box"},s&&s.length>0&&s.map((e,t)=>{return f.default.createElement("div",{key:t},f.default.createElement("span",{style:{color:"#666666"}},f.default.createElement("span",null,t+1)),f.default.createElement("span",{ref:"texts",style:{width:"100%",color:"#FFF"}},f.default.createElement(m.default,null,e)))})||t&&t.length>0&&t.map((e,a)=>{return f.default.createElement("div",{key:a},f.default.createElement("span",{style:{color:n==e.substring(0,e.indexOf(":"))?y?"#FFF":"#FFFF91":"#666666"}},f.default.createElement("span",null,""==e?"":"".concat(a+1))),f.default.createElement("span",{ref:"texts",style:{color:n==e.substring(0,e.indexOf(":"))?y?"#FFF":"#FFFF91":"#FFF"}},f.default.createElement(m.default,null,e.substring(e.indexOf(":")+1,e.length))),1==t.length?f.default.createElement("span",{style:{color:n==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:n==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},f.default.createElement(m.default,null,e.substring(0,e.indexOf(":")))):t.length>1&&a>=1&&e.substring(0,e.indexOf(":"))==t[a<=0?a+1:a-1].substring(0,t[a<=0?a+1:a-1].indexOf(":"))?"":y?"":f.default.createElement("span",{style:{color:n==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==a&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==t[a<=0?a+1:a-1].substring(0,t[a<=0?a+1:a-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:n==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},f.default.createElement(m.default,null,e.substring(0,e.indexOf(":")))))})),u&&f.default.createElement(v.default,{onCancel:this.hideDownHistoryLog,RbdName:x,region:_}),h&&f.default.createElement(E.default,{onCancel:this.hideDownHistory1000Log,RbdName:x,region:_}))}},c=u))||c);t.default=x},yUTz:function(e,t,a){"use strict";var s=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l=s(a("bx4M"));a("Znn+");var o,r,i,d=s(a("ZTPi")),c=a("MuoO"),u=(a("7DNP"),n(a("q1tI"))),g=a("LLXN"),h=s(a("pKpl")),f=s(a("dnMv")),m=d.default.TabPane,p=(o=(0,c.connect)(null,null,null,{withRef:!0}),o((i=class extends u.PureComponent{constructor(e){super(e),this.fetchUpClusters=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.regionId;t({type:"region/fetchEnterpriseCluster",payload:{region_id:s,enterprise_id:a},callback:e=>{e&&200===e.status_code&&this.setState({wsurl:e.bean.wsurl})}})}),this.fetchInstanceInfo=(()=>{var e=this.props,t=e.dispatch,a=e.region;t({type:"region/fetchClusterLogInfo",payload:{region_name:a},callback:e=>{var t=[];if(e&&e.bean){var a=e.bean.list&&e.bean.list.length&&e.bean.list||[];t=[...a]}this.setState({list:t},()=>{this.callback(0)})}})}),this.callback=(e=>{var t=this.state,a=t.list,s=t.enClusterArr,n=[];a.filter(t=>{if(-1!=t.rbd_name.indexOf(s[e]))return n.push(t)}),this.setState({instances:n})}),this.state={ClusterArr:["".concat((0,g.formatMessage)({id:"LogEnterprise.getway"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.api"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.chaos"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.worker"}))],enClusterArr:["rbd-gateway","rbd-api","rbd-chaos","rbd-worker"],list:[],instances:[],logs:[],wsurl:null}}componentDidMount(){this.fetchInstanceInfo(),this.fetchUpClusters()}render(){var e=this.props,t=e.region,a=(e.tcpUrl,this.state),s=a.ClusterArr,n=a.instances,o=a.enClusterArr,r=a.wsurl;return u.default.createElement(u.default.Fragment,null,u.default.createElement(l.default,{style:{padding:"24px 0px"}},u.default.createElement(d.default,{tabPosition:"left",defaultActiveKey:"0",onChange:this.callback,destroyInactiveTabPane:!0,className:f.default.tabsStyle},s&&s.length>0&&null!=r&&s.map((e,a)=>{return u.default.createElement(m,{tab:e,key:a},u.default.createElement(h.default,{region:t,instances:n,RbdName:o[a],tcpUrl:r}))}))))}},r=i))||r),b=p;t.default=b}}]);