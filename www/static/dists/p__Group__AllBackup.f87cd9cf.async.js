(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[57],{VDAs:function(e,t,a){"use strict";var s=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l=s(a("bx4M"));a("g9YV");var r=s(a("wCAj"));a("/xke");var u=s(a("TeRw"));a("Pwec");var o,c,d,p,n,h,m=s(a("CtXQ")),g=a("MuoO"),k=a("7DNP"),f=i(a("q1tI")),_=a("LLXN"),b=s(a("nyIC")),B=s(a("q76B")),M=s(a("D+Pu")),v=s(a("br/n")),y=s(a("XZXw")),S=s(a("QDog")),A=s(a("ym8O")),D=s(a("ZgmS")),w=s(a("+iC2")),O=(o=(0,g.connect)(e=>{var t=e.user;return{currUser:t.currentUser}}),o((d=class extends f.PureComponent{constructor(e){super(e),this.getSocketUrl=(()=>{return w.default.getCurrRegionSoketUrl(this.props.currUser)}),this.state={map:{starting:(0,_.formatMessage)({id:"teamOther.AllBackup.Backup"}),success:(0,_.formatMessage)({id:"teamOther.AllBackup.success"}),failed:(0,_.formatMessage)({id:"teamOther.AllBackup.failed"})}},this.timer=null}componentDidMount(){var e=this.props.data;"starting"===e.status&&(this.createSocket(),this.startLoopStatus())}createSocket(){this.logSocket=new A.default({url:this.getSocketUrl(),eventId:this.props.data.event_id,onMessage:e=>{console.log(e)}})}componentWillUnmount(){this.stopLoopStatus(),this.logSocket&&this.logSocket.destroy(),this.logSocket=null}startLoopStatus(){this.props.dispatch({type:"application/fetchBackupStatus",payload:{team_name:S.default.getCurrTeamName(),backup_id:this.props.data.backup_id,group_id:this.props.group_id},callback:e=>{if(e){var t=e.bean;"starting"===t.status?this.timer=setTimeout(()=>{this.startLoopStatus()},1e4):this.props.onEnd&&this.props.onEnd()}}})}stopLoopStatus(){clearTimeout(this.timer)}render(){var e=this.props.data||{};return f.default.createElement("span",null,this.state.map[e.status]," ","starting"===e.status&&f.default.createElement(m.default,{style:{marginLeft:8},type:"loading",spin:!0}))}},c=d))||c),C=(p=(0,g.connect)(e=>{var t=e.user,a=e.global,s=e.application;return{groupDetail:s.groupDetail||{},currUser:t.currentUser,groups:a.groups||[]}}),p((h=class extends f.default.Component{constructor(e){super(e),this.fetchAllBackup=(()=>{var e=this.props.dispatch,t=this.state,a=t.pageNum,s=t.pageSize;e({type:"application/queryAllBackup",payload:{team_name:S.default.getCurrTeamName(),pageNum:a,pageSize:s},callback:e=>{e&&this.setState({list:e.list,tableLoading:!1,total:e.total})}})}),this.onPageChange=(e=>{this.setState({pageNum:e,tableLoading:!0},()=>{this.fetchAllBackup()})}),this.handleMoveBackup=(()=>{this.setState({showMove:!1})}),this.cancelMoveBackup=(()=>{this.setState({showMove:!1,backup_id:"",group_id:""})}),this.handleRecoveryBackup=(()=>{this.setState({showRecovery:!1,backup_id:"",group_id:""}),this.fetchAllBackup()}),this.cancelRecoveryBackup=(()=>{this.setState({showRecovery:!1,backup_id:"",group_id:""}),this.fetchAllBackup()}),this.handleDel=(e=>{this.setState({showDel:!0,backup_id:e.backup_id,group_id:e.group_id})}),this.handleDelete=(()=>{var e=S.default.getCurrTeamName();this.props.dispatch({type:"application/delBackup",payload:{team_name:e,group_id:this.state.group_id,backup_id:this.state.backup_id},callback:()=>{u.default.success({message:(0,_.formatMessage)({id:"notification.success.delete"}),duration:"2"}),this.cancelDelete(),this.fetchAllBackup()}})}),this.cancelDelete=(()=>{this.setState({showDel:!1,backup_id:""},()=>{this.fetchAllBackup()})}),this.handleDelBackup=(e=>{this.setState({showDelBackup:!0,backup_id:e.backup_id,group_id:e.group_id})}),this.handleDeleteBackup=(()=>{var e=S.default.getCurrTeamName();this.props.dispatch({type:"application/delFailureBackup",payload:{team_name:e,group_id:this.state.group_id,backup_id:this.state.backup_id},callback:()=>{u.default.success({message:(0,_.formatMessage)({id:"notification.success.delete"}),duration:"2"}),this.cancelDeleteBackup()}})}),this.cancelDeleteBackup=(()=>{this.setState({showDelBackup:!1,backup_id:""},()=>{this.fetchAllBackup()})}),this.handleRecovery=(e=>{this.setState({showRecovery:!0,backup_id:e.backup_id,group_uuid:e.group_uuid,group_id:e.group_id})}),this.handleMove=(e=>{this.setState({showMove:!0,backup_id:e.backup_id,group_uuid:e.group_uuid,group_id:e.group_id,moveBackupMode:e.mode})}),this.handleExport=(e=>{var t=e.backup_id,a=S.default.getCurrTeamName(),s=e.group_id,i="".concat(b.default.baseUrl,"/console/teams/").concat(a,"/groupapp/").concat(s,"/backup/export?backup_id=").concat(t);window.open(i),u.default.success({message:(0,_.formatMessage)({id:"status.app.backups.yolkStroke"}),duration:"2"})}),this.state={tableLoading:!0,list:[],total:0,pageNum:1,pageSize:10,showMove:!1,showDel:!1,showDelBackup:!1,showRecovery:!1,backup_id:"",group_uuid:"",group_id:""}}componentWillMount(){this.fetchAllBackup()}render(){var e=[{title:(0,_.formatMessage)({id:"teamOther.AllBackup.create_time"}),dataIndex:"create_time"},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.user"}),dataIndex:"user"},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.mode"}),dataIndex:"mode",render:(e,t)=>{var a={"full-online":"".concat((0,_.formatMessage)({id:"teamOther.AllBackup.full-online"})),"full-offline":"".concat((0,_.formatMessage)({id:"teamOther.AllBackup.full-offline"}))};return a[e]||""}},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.backup_size"}),dataIndex:"backup_size",render:(e,t)=>{return D.default.unit(e,"Byte")}},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.state"}),dataIndex:"status",render:(e,t)=>{return f.default.createElement(O,{onEnd:this.fetchAllBackup,group_id:t.group_id,data:t})}},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.app"}),dataIndex:"group_name",render:(e,t)=>{return e.includes("\u5df2\u5220\u9664")?f.default.createElement("a",{href:"",disabled:!0},e):f.default.createElement(k.Link,{to:"/team/".concat(S.default.getCurrTeamName(),"/region/").concat(S.default.getCurrRegionName(),"/apps/").concat(t.group_id,"/")},e)}},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.remarks"}),dataIndex:"note"},{title:(0,_.formatMessage)({id:"teamOther.AllBackup.operation"}),dataIndex:"action",render:(e,t)=>{return f.default.createElement("div",null,"success"==t.status?f.default.createElement(f.Fragment,null,f.default.createElement("a",{href:"javascript:;",style:{marginRight:"5px"},onClick:this.handleRecovery.bind(this,t)},(0,_.formatMessage)({id:"teamOther.AllBackup.recovery"})),f.default.createElement("a",{href:"javascript:;",style:{marginRight:"5px"},onClick:this.handleMove.bind(this,t)},(0,_.formatMessage)({id:"teamOther.AllBackup.transfer"})),"full-online"==t.mode&&f.default.createElement("a",{href:"javascript:;",style:{marginRight:"5px"},onClick:this.handleExport.bind(this,t)},(0,_.formatMessage)({id:"teamOther.AllBackup.export"})),t.is_delete&&f.default.createElement("a",{href:"javascript:;",style:{marginRight:"5px"},onClick:this.handleDelBackup.bind(this,t)},(0,_.formatMessage)({id:"teamOther.AllBackup.delete"}))):"","failed"==t.status?f.default.createElement(f.Fragment,null,f.default.createElement("a",{href:"javascript:;",onClick:this.handleDel.bind(this,t)},(0,_.formatMessage)({id:"teamOther.AllBackup.delete"}))):"")}}],t=this.state,a=t.tableLoading,s=t.pageNum,i=t.pageSize,u=t.total,o=t.list,c=this.props.match.params.regionName;return f.default.createElement(y.default,{title:(0,_.formatMessage)({id:"teamOther.AllBackup.records"}),content:(0,_.formatMessage)({id:"teamOther.AllBackup.all_records"})},f.default.createElement(l.default,null,f.default.createElement(r.default,{rowKey:e=>{return e.backup_id},pagination:{total:u,pageSize:i,current:s,onChange:this.onPageChange},columns:e,dataSource:o,loading:a})),this.state.showMove&&f.default.createElement(M.default,{onOk:this.handleMoveBackup,onCancel:this.cancelMoveBackup,backupId:this.state.backup_id,group_uuid:this.state.group_uuid,groupId:this.state.group_id,currentRegion:c,moveBackupMode:this.state.moveBackupMode}),this.state.showRecovery&&f.default.createElement(v.default,{onOk:this.handleRecoveryBackup,onCancel:this.cancelRecoveryBackup,propsParams:this.props.match.params,backupId:this.state.backup_id,group_uuid:this.state.group_uuid,groupId:this.state.group_id}),this.state.showDel&&f.default.createElement(B.default,{backupId:this.state.backup_id,onOk:this.handleDelete,onCancel:this.cancelDelete,title:(0,_.formatMessage)({id:"confirmModal.backup.title.delete"}),desc:(0,_.formatMessage)({id:"confirmModal.backup.delete.desc"}),subDesc:(0,_.formatMessage)({id:"confirmModal.delete.strategy.subDesc"})}),this.state.showDelBackup&&f.default.createElement(B.default,{backupId:this.state.backup_id,onOk:this.handleDeleteBackup,onCancel:this.cancelDeleteBackup,title:(0,_.formatMessage)({id:"confirmModal.backup.title.delete"}),desc:(0,_.formatMessage)({id:"confirmModal.backup.delete.desc"}),subDesc:(0,_.formatMessage)({id:"confirmModal.delete.strategy.subDesc"})}))}},n=h))||n),E=C;t.default=E}}]);