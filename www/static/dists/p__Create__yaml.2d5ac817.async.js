(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[37],{"1+/a":function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,n,o,d=r(a("jehZ")),i=a("MuoO"),u=a("7DNP"),p=s(a("q1tI")),c=a("LLXN"),m=(r(a("I3bc")),r(a("XZXw"))),h=a("vSx2"),f=r(a("2pvv")),g=r(a("QDog")),_=(r(a("tH/r")),r(a("2lxJ"))),v=(r(a("mWxT")),r(a("hMqj"))),b=r(a("X5up")),y=r(a("/KFZ")),C=(l=(0,i.connect)(e=>{var t=e.teamControl,a=e.global,r=e.enterprise;return{rainbondInfo:a.rainbondInfo,currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:r.currentEnterprise,enterprise:a.enterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{pure:!1}),l((o=class extends p.PureComponent{constructor(){super(...arguments),this.handleTabChange=(e=>{var t=this.props.dispatch;t(u.routerRedux.push("/team/".concat(g.default.getCurrTeamName(),"/region/").concat(g.default.getCurrRegionName(),"/create/yaml/").concat(e)))})}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch;v.default.canCreateComponent(t,a)}render(){var e=this.props,t=(e.rainbondInfo,e.enterprise,e.match),a=e.currentEnterprise,r=e.currentTeam,s=e.currentRegionName,l={yaml:b.default,importCluster:f.default,helm:y.default},n=[{key:"yaml",tab:(0,c.formatMessage)({id:"teamAdd.create.upload.uploadFiles.yaml"})},{key:"importCluster",tab:(0,c.formatMessage)({id:"teamAdd.create.upload.uploadFiles.k8s"})},{key:"helm",tab:(0,c.formatMessage)({id:"teamAdd.create.upload.uploadFiles.helm"})}],o=t.params.type;o||(o="yaml");var i=l[o],u=[];return u=(0,h.createTeam)((0,h.createEnterprise)(u,a),r,s),u.push({title:"\u521b\u5efa\u7ec4\u4ef6"}),p.default.createElement(m.default,{breadcrumbList:u,title:(0,c.formatMessage)({id:"teamAdd.create.upload.title"}),onTabChange:this.handleTabChange,content:p.default.createElement("p",null,(0,c.formatMessage)({id:"teamAdd.create.upload.desc"})),tabActiveKey:o,tabList:n,titleSvg:_.default.getSvg("yamlSvg",18)},i?p.default.createElement(i,(0,d.default)({},this.props,{type:this.props.match.params.type,tabList:n})):p.default.createElement(p.default.Fragment,null,(0,c.formatMessage)({id:"teamAdd.create.error"})))}},n=o))||n);t.default=C},IMHh:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=r(a("jehZ"));a("Pwec");var n=r(a("CtXQ"));a("+L6B");var o=r(a("2/Rp"));a("/xke");var d=r(a("TeRw"));a("y8nQ");var i=r(a("Vl3Y"));a("OaEy");var u=r(a("2fM7"));a("DZo9");var p,c,m,h,f=r(a("8z0m")),g=a("MuoO"),_=a("7DNP"),v=s(a("q1tI")),b=a("LLXN"),y=(r(a("XZXw")),r(a("qCJ4"))),C=r(a("hMqj")),N=r(a("QDog")),E=r(a("SvLO")),S=(a("xpXo"),f.default.Dragger),A=u.default.Option,M=(p=i.default.create(),c=(0,g.connect)(e=>{var t=e.teamControl,a=e.global,r=e.enterprise;return{groups:a.groups,rainbondInfo:a.rainbondInfo,currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:r.currentEnterprise,enterprise:a.enterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{pure:!1}),p(m=c((h=class extends v.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.dispatch,s=N.default.getCurrTeamName(),l=N.default.getCurrRegionName(),n=this.state,o=n.event_id,i=n.existFileList,u=n.groupName;a.validateFields((e,t)=>{e||(i.length>0?r(_.routerRedux.push("/team/".concat(s,"/region/").concat(l,"/importMessageYaml?event_id=").concat(o,"&group_id=").concat(t.group_id,"&group_name=").concat(u))):(this.loop=!0,this.handleJarWarUploadStatus(),d.default.error({message:(0,b.formatMessage)({id:"notification.error.notDetected"})})))})}),this.handleChange=(e=>{for(var t=this.props,a=(t.dispatch,t.groups),r=0;r<a.length;r++)if(a[r].group_id===e){this.setState({groupName:a[r].group_name});break}}),this.onAddGroup=(()=>{this.setState({addGroup:!0})}),this.cancelAddGroup=(()=>{this.setState({addGroup:!1})}),this.handleAddGroup=(e=>{var t=this.props.form.setFieldsValue;t({group_id:e}),this.cancelAddGroup()}),this.handleJarWarUpload=(()=>{var e=this.props.dispatch,t=N.default.getCurrTeamName(),a=N.default.getCurrRegionName();e({type:"createApp/createJarWarServices",payload:{region:a,team_name:t,component_id:""},callback:e=>{e&&200===e.status_code&&this.setState({record:e.bean,event_id:e.bean.event_id,region_name:e.bean&&e.bean.region,team_name:e.bean&&e.bean.team_name},()=>{""!==e.bean.region&&(this.loop=!0,this.handleJarWarUploadStatus())})}})}),this.handleJarWarUploadRecord=(e=>{var t=this.props.dispatch;t({type:"createApp/createJarWarUploadRecord",payload:{region:N.default.getCurrRegionName(),team_name:N.default.getCurrTeamName(),file_type:e,component_id:""},callback:e=>{e.bean&&e.bean.source_dir&&e.bean.source_dir.length>0?this.setState({existFileList:e.bean.source_dir,event_id:e.bean.event_id}):(this.setState({existFileList:[]}),this.handleJarWarUpload())},handleError:()=>{}})}),this.handleJarWarUploadStatus=(()=>{var e=this.props.dispatch,t=this.state.event_id;e({type:"createApp/createJarWarUploadStatus",payload:{region:N.default.getCurrRegionName(),team_name:N.default.getCurrTeamName(),event_id:t},callback:e=>{e&&e.bean.package_name.length>0&&(this.setState({existFileList:e.bean.package_name}),d.default.success({message:(0,b.formatMessage)({id:"notification.success.upload_file"})}),this.loop=!1),this.loop&&setTimeout(()=>{this.handleJarWarUploadStatus()},3e3)},handleError:()=>{}})}),this.handleJarWarUploadDelete=(()=>{var e=this.state.event_id,t=this.props.dispatch;t({type:"createApp/deleteJarWarUploadStatus",payload:{team_name:N.default.getCurrTeamName(),event_id:e},callback:e=>{"ok"==e.bean.res&&(this.setState({existFileList:[]}),d.default.success({message:(0,b.formatMessage)({id:"notification.success.delete_file"})}),this.handleJarWarUpload())}})}),this.onChangeUpload=(e=>{var t=e.fileList;t=t.filter(e=>{return!e.response||"success"===e.response.msg}),e&&e.event&&e.event.percent&&this.setState({percents:e.event.percent});var a=e.file.status;"done"===a&&this.setState({percents:!1}),this.setState({fileList:t})}),this.onRemove=(()=>{this.setState({fileList:[]})}),this.state={fileList:[],defaultRadio:"jwar",isShowCom:!0,addGroup:!1,record:{},event_id:"",region_name:"",team_name:"",percents:!1,existFileList:[],groupName:""}}componentWillMount(){this.loop=!1,this.statusloop=!1;var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch;C.default.canCreateComponent(t,a)}componentDidMount(){this.handleJarWarUploadRecord("jwar")}componentWillUnmount(){this.loop=!1,this.statusloop=!1}render(){var e=this.props,t=e.form.getFieldDecorator,a=e.groups,r={},s=this.state,d=s.fileList,p=(s.defaultRadio,s.isShowCom,s.addGroup),c=s.record,m=(s.region_name,s.existFileList),h={labelCol:{span:9},wrapperCol:{span:15}};return v.default.createElement(v.default.Fragment,null,v.default.createElement("div",{className:E.default.yaml_container},v.default.createElement(i.default,(0,l.default)({},h,{onSubmit:this.handleSubmit}),v.default.createElement(i.default.Item,{label:(0,b.formatMessage)({id:"teamAdd.create.form.appName"}),style:{display:"flex"}},t("group_id",{rules:[{required:!0,message:(0,b.formatMessage)({id:"placeholder.group_name"})}]})(v.default.createElement(u.default,{onChange:this.handleChange,getPopupContainer:e=>e.parentNode,placeholder:(0,b.formatMessage)({id:"placeholder.appName"}),style:{display:"inline-block",width:276,marginRight:10}},(a||[]).map(e=>v.default.createElement(A,{value:e.group_id},e.group_name)))),v.default.createElement(o.default,{onClick:this.onAddGroup},(0,b.formatMessage)({id:"teamApply.createApp"}))),v.default.createElement(i.default.Item,{label:(0,b.formatMessage)({id:"teamAdd.create.upload.uploadFiles"}),extra:(0,b.formatMessage)({id:"teamAdd.create.upload.uploadYaml"})},t("packageTarFile",{})(v.default.createElement(S,{fileList:d,accept:".yaml,.yml",name:"packageTarFile",onChange:this.onChangeUpload,onRemove:this.onRemove,action:c.upload_url,headers:r,multiple:!0},v.default.createElement("p",{className:"ant-upload-drag-icon"},v.default.createElement(n.default,{type:"inbox"}))))),v.default.createElement(i.default.Item,{label:(0,b.formatMessage)({id:"teamAdd.create.fileList"})},m.length>0?v.default.createElement("div",{className:E.default.update},v.default.createElement("div",{className:E.default.delete},v.default.createElement(n.default,{onClick:this.handleJarWarUploadDelete,style:{marginLeft:"12px",color:"red",cursor:"pointer"},type:"close"})),m.map(e=>{return v.default.createElement("div",{className:E.default.fileName},v.default.createElement(n.default,{style:{marginRight:"6px"},type:"inbox"}),e)})):v.default.createElement("div",{className:E.default.empty},(0,b.formatMessage)({id:"teamAdd.create.null_data"}))),v.default.createElement(i.default.Item,{wrapperCol:{xs:{span:7,offset:7},sm:{span:9,offset:9}}},v.default.createElement(o.default,{type:"primary",htmlType:"submit"},(0,b.formatMessage)({id:"teamAdd.create.btn.create"}))))),p&&v.default.createElement(y.default,{onCancel:this.cancelAddGroup,onOk:this.handleAddGroup}))}},m=h))||m)||m);t.default=M},SvLO:function(e,t,a){e.exports={yaml_container:"yaml_container___3C6bK",update:"update___3zjEH",delete:"delete___2hq8X",fileName:"fileName___2-6m1",empty:"empty___2MNhv"}},X5up:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l,n,o,d=r(a("bx4M")),i=r(a("jehZ")),u=r(a("p0pE")),p=a("MuoO"),c=a("7DNP"),m=s(a("q1tI")),h=(a("LLXN"),r(a("IMHh"))),f=r(a("/BFj")),g=r(a("QDog")),_=r(a("51sS")),v=(l=(0,p.connect)(e=>{var t=e.user,a=e.global;return{currUser:t.currentUser,groups:a.groups}}),l((o=class extends m.PureComponent{constructor(e){super(e),this.onAddGroup=(()=>{this.setState({addGroup:!0})}),this.cancelAddGroup=(()=>{this.setState({addGroup:!1})}),this.handleAddGroup=(e=>{var t=this.props.form.setFieldsValue;this.props.dispatch({type:"application/addGroup",payload:(0,u.default)({team_name:g.default.getCurrTeamName()},e),callback:e=>{e&&this.props.dispatch({type:"global/fetchGroups",payload:{team_name:g.default.getCurrTeamName(),region_name:g.default.getCurrRegionName()},callback:()=>{t({group_id:e.group_id}),this.cancelAddGroup()}})}})}),this.hideShowKey=(()=>{this.setState({showKey:!1})}),this.handleSubmit=(e=>{var t=g.default.getCurrTeamName(),a=e.username_1,r=e.password_1;delete e.username_1,delete e.password_1,this.props.dispatch({type:"createApp/createAppByCode",payload:(0,u.default)({team_name:t,code_from:"gitlab_manual"},e,{username:a,password:r}),callback:e=>{if(e){var t=e.bean.service_alias;this.props.handleType&&"Service"===this.props.handleType?this.props.handleServiceGetData(t):this.props.dispatch(c.routerRedux.push("/team/".concat(g.default.getCurrTeamName(),"/region/").concat(g.default.getCurrRegionName(),"/create/create-check/").concat(t)))}}})}),this.state={}}render(){return m.default.createElement(d.default,null,m.default.createElement(f.default,null),m.default.createElement("div",{className:_.default.formWrap,style:{width:this.props.handleType&&"Service"===this.props.handleType?"auto":"600px"}},m.default.createElement(h.default,(0,i.default)({onSubmit:this.handleSubmit},this.props))))}},n=o))||n);t.default=v}}]);