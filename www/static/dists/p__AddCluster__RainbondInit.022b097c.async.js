(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{Jq4M:function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=n(a("kLXV"));a("fOrg");var s=n(a("+KLJ"));a("jCWc");var i=n(a("kPKH"));a("sRBo");var d=n(a("kaz8"));a("+L6B");var o=n(a("2/Rp")),u=n(a("jehZ"));a("/xke");var c=n(a("TeRw"));a("y8nQ");var p=n(a("Vl3Y"));a("tU7J");var m,f,h,g,C=n(a("wFql")),I=n(a("18gR")),E=a("MuoO"),b=l(a("q1tI")),v=a("LLXN"),y=a("mLYH"),k=n(a("AklW")),R=n(a("QDog")),M=n(a("ZNrE")),S=n(a("dBUJ")),w=n(a("imTl")),x=n(a("aMNY")),D=C.default.Paragraph,F=(m=(0,E.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),f=p.default.create(),m(h=f((g=class extends b.PureComponent{constructor(e){super(e),this.initRainbondCluster=(()=>{var e=this.props,t=e.dispatch,a=e.clusterID,n=e.selectProvider,l=e.eid,r=e.rainbondInfo,s=e.enterprise,i=this.state,d=i.checked,o=i.task;d?(this.setState({loading:!0}),t({type:"cloud/initRainbondRegion",payload:{enterprise_id:l,providerName:n,clusterID:a,retry:o&&"complete"===o.status},callback:e=>{e&&(R.default.putInstallClusterLog(s,r,{eid:l,taskID:e.taskID,status:"start",install_step:"createRainbond",provider:n}),this.setState({loading:!1,task:e,showInitDetail:!0}))},handleError:e=>{e&&e.data&&7005===e.data.code?this.setState({loading:!1,showInitDetail:!0,task:e.data.data}):k.default.handleCloudAPIError(e)}})):c.default.warning({message:(0,v.formatMessage)({id:"notification.warn.read"})})}),this.loadTask=(e=>{var t=this.props,a=t.dispatch,n=t.eid,l=t.clusterID,r=t.selectProvider,s=t.completeInit;a({type:"cloud/loadInitRainbondTask",payload:{enterprise_id:n,clusterID:l,providerName:r},callback:t=>{if(t&&200===t.status_code&&t.response_data&&t.response_data.data){var a=t.response_data.data;this.setState({task:a}),"inited"===a.status?s&&s(a):"complete"===a.status||e||this.setState({showInitDetail:!0})}},handleError:e=>{e&&e.data&&404===e.data.code||(k.default.handleCloudAPIError(e),this.setState({loading:!1}))}})}),this.cancelShowInitDetail=(()=>{this.setState({showInitDetail:!1}),this.loadTask(!0)}),this.setChecked=(e=>{this.setState({checked:e.target.checked})}),this.showSetRainbondCluster=(()=>{var e=this.props,t=e.eid,a=e.clusterID;(0,y.getRainbondClusterConfig)({enterprise_id:t,clusterID:a},e=>{e&&e.data&&404===e.data.code||k.default.handleCloudAPIError(e)}).then(e=>{this.setState({showClusterInitConfig:!0,initconfig:e.config})})}),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.eid,n=e.clusterID;t.validateFields((e,t)=>{e||(0,y.setRainbondClusterConfig)({enterprise_id:a,clusterID:n,config:t.config},e=>{e&&e.data&&404===e.data.code||k.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&(c.default.success({message:(0,v.formatMessage)({id:"notification.success.setting_successfully"})}),this.setState({showClusterInitConfig:!1}))})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,n=e.handleClick,l=void 0===n?()=>{}:n;return b.default.createElement(I.default,(0,u.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close")},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(l(),this.handleGuideStep(a))}}))}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.state={checked:!1,loading:!1,showInitDetail:!1,task:null,isComponents:!1,guideStep:10}}componentDidMount(){this.loadTask()}render(){var e=this.props,t=e.preStep,a=e.eid,n=e.selectProvider,l=e.form,u=e.clusterID,c=this.state,m=c.showInitDetail,f=c.loading,h=c.task,g=c.showClusterInitConfig,C=c.initconfig,I=c.isComponents,E=c.guideStep,y=c.checked,k={labelCol:{xs:{span:24}},wrapperCol:{xs:{span:24}}},R=l.getFieldDecorator,F=l.setFieldsValue,P=10===E?{position:"relative",zIndex:1e3,padding:"0 16px",margin:"0 -16px",background:"#fff"}:{},N=("rke"===n||"custom"===n)&&b.default.createElement(o.default,{style:{marginRight:"16px"},onClick:()=>this.handleIsComponents(!0)},b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.look"}));return b.default.createElement(p.default,null,b.default.createElement("h4",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.careful"})),b.default.createElement(i.default,{span:24,style:{padding:"16px"}},"ack"===n&&b.default.createElement(D,{className:S.default.describe,style:P},b.default.createElement("ul",null,b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.initialization"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.resources"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.mode"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.remove"}))))),("rke"===n||"custom"===n)&&b.default.createElement(D,{className:S.default.describe,style:P},b.default.createElement("ul",null,b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.select"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.default"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.port"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.availability"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.Installed"}))),b.default.createElement("li",null,b.default.createElement("span",null,b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.cluster"})," ",b.default.createElement("a",{onClick:()=>{this.showSetRainbondCluster()}},b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.click"})))))),b.default.createElement(p.default.Item,{name:"remember",valuePropName:"checked",noStyle:!0},b.default.createElement(d.default,{onChange:this.setChecked,style:P,checked:y},b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.precautions"})),10===E&&this.handleNewbieGuiding({tit:(0,v.formatMessage)({id:"enterpriseColony.RainbondClusterInit.service"}),send:!1,configName:"kclustersAttentionAttention",nextStep:11,btnText:(0,v.formatMessage)({id:"enterpriseColony.RainbondClusterInit.Known"}),conPosition:{left:0,bottom:"-192px"},svgPosition:{left:"3px",marginTop:"-19px"},handleClick:()=>{this.setState({checked:!0})}}))),b.default.createElement(i.default,{style:{textAlign:"center",marginTop:"32px"},span:24},h&&"complete"!==h.status?b.default.createElement(b.Fragment,null,b.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},b.default.createElement(v.FormattedMessage,{id:"button.previous"})),N,b.default.createElement(o.default,{onClick:()=>{this.setState({showInitDetail:!0})},type:"primary"},b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.Initializing"}))):b.default.createElement(b.Fragment,null,b.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},b.default.createElement(v.FormattedMessage,{id:"button.previous"})),N,b.default.createElement(o.default,{loading:f,onClick:this.initRainbondCluster,type:"primary"},h?b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.Reinitialize"}):b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.start"}))),11===E&&this.handleNewbieGuiding({tit:(0,v.formatMessage)({id:"enterpriseColony.RainbondClusterInit.start"}),desc:(0,v.formatMessage)({id:"enterpriseColony.RainbondClusterInit.configuration"}),send:!0,configName:"kclustersAttentionAttention",nextStep:12,conPosition:{left:"63%",bottom:"-39px"},svgPosition:{left:"58%",marginTop:"-13px"},handleClick:()=>{this.initRainbondCluster()}})),I&&u&&b.default.createElement(w.default,{eid:a,clusterID:u,providerName:n,onCancel:()=>{this.handleIsComponents(!1)}}),m&&h&&b.default.createElement(x.default,{onCancel:this.cancelShowInitDetail,eid:a,guideStep:E,handleNewbieGuiding:this.handleNewbieGuiding,providerName:n,clusterID:h.clusterID,taskID:h.taskID}),g&&b.default.createElement(r.default,{visible:!0,title:b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.set"}),onOk:this.handleSubmit,width:800,confirmLoading:f,onCancel:()=>{this.setState({showClusterInitConfig:!1})}},b.default.createElement(s.default,{message:b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.Example"}),type:"warning",style:{marginBottom:"16px"}}),b.default.createElement(M.default,{titles:b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.all"}),setFieldsValue:F,formItemLayout:k,Form:p.default,getFieldDecorator:R,mode:"yaml",name:"config",data:C,label:b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.Cluster"}),message:b.default.createElement(v.FormattedMessage,{id:"enterpriseColony.RainbondClusterInit.required"}),width:"750px"})))}},h=g))||h)||h);t.default=F},XdbD:function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=n(a("bx4M"));a("14J3");var s=n(a("BMrR"));a("y8nQ");var i=n(a("Vl3Y"));a("FJo9");var d,o,u,c,p=n(a("L41K")),m=a("MuoO"),f=a("7DNP"),h=a("LLXN"),g=l(a("q1tI")),C=n(a("Jq4M")),I=n(a("XZXw")),E=n(a("2lxJ")),b=n(a("+iC2")),v=p.default.Step,y=(d=i.default.create(),o=(0,m.connect)(e=>{var t=e.user,a=e.list,n=e.loading,l=e.global,r=e.index;return{user:t.currentUser,list:a,loading:n.models.list,rainbondInfo:l.rainbondInfo,enterprise:l.enterprise,isRegist:l.isRegist,oauthLongin:n.effects["global/creatOauth"],overviewInfo:r.overviewInfo}}),d(u=o((c=class extends g.PureComponent{constructor(e){super(e),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(f.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,n=t.provider;e(f.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(n,"/kclusters")))}),this.loadSteps=(()=>{var e=[{title:(0,h.formatMessage)({id:"enterpriseColony.addCluster.supplier"})},{title:(0,h.formatMessage)({id:"enterpriseColony.addCluster.cluster"})},{title:(0,h.formatMessage)({id:"enterpriseColony.addCluster.Initialize"})},{title:(0,h.formatMessage)({id:"enterpriseColony.addCluster.docking"})}];return e}),this.completeInit=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,n=t.provider,l=t.clusterID;e(f.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(n,"/kclusters/").concat(l,"/link")))});var t=this.props.user,a=b.default.isCompanyAdmin(t);this.state={adminer:a}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(f.routerRedux.push("/"))}componentDidMount(){}render(){var e=this.props.match.params,t=e.eid,a=e.provider,n=e.clusterID,l=e.taskID;return g.default.createElement(I.default,{title:g.default.createElement(h.FormattedMessage,{id:"enterpriseColony.button.text"}),content:g.default.createElement(h.FormattedMessage,{id:"enterpriseColony.PageHeaderLayout.content"}),titleSvg:E.default.getSvg("clusterSvg",18)},g.default.createElement(s.default,{style:{marginBottom:"16px"}},g.default.createElement(p.default,{current:2},this.loadSteps().map(e=>g.default.createElement(v,{key:e.title,title:e.title})))),g.default.createElement(r.default,null,g.default.createElement(s.default,{style:{marginBottom:"16px"}},g.default.createElement(C.default,{eid:t,completeInit:this.completeInit,selectProvider:a,taskID:l,clusterID:n,preStep:this.preStep}))))}},u=c))||u)||u);t.default=y}}]);